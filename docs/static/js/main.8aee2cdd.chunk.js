(this["webpackJsonpmotty-derby"]=this["webpackJsonpmotty-derby"]||[]).push([[0],{273:function(e,n,t){},460:function(e,n,t){},470:function(e,n,t){},472:function(e,n,t){"use strict";t.r(n);var a=t(2),r=t(249),c=t(513),o=t(0),i=t.n(o),l=t(15),s=t.n(l),u=(t(273),t(139)),f=t(11),d=t(137),m=t(515),b=t(257),j=t(258),h=t(77),O=t(167),p=(t(460),t(20)),x=function(){var e=Object(o.useRef)(null),n=Object(p.c)((function(e){return e.horseDefs.list})),t=Object(o.useMemo)((function(){return function(e){var n=new Map,t=[];return e.forEach((function(e){n.set(e.name,{label:e.name,class:"owned ".concat(e.sex)}),e.motherName&&(n.has(e.motherName)||n.set(e.motherName,{label:e.motherName,class:"anothers female"}),t.push([{v:e.motherName,w:e.name},{class:"mother"}])),e.fatherName&&(n.has(e.fatherName)||n.set(e.fatherName,{label:e.fatherName,class:"anothers male"}),t.push([{v:e.fatherName,w:e.name},{class:"father"}]))})),{nodes:Array.from(n.entries()),edges:t}}(n)}),[n]);return Object(o.useEffect)((function(){var n=h.select(e.current);if(n.selectAll("g").remove(),0!==t.nodes.length||0!==t.edges.length){var a=(new O.graphlib.Graph).setGraph({rankdir:"LR"}).setDefaultEdgeLabel((function(){return{}}));t.nodes.forEach((function(e){a.setNode(e[0],e[1])})),a.nodes().forEach((function(e){var n=a.node(e);n.rx=n.ry=5})),t.edges.forEach((function(e){a.setEdge(e[0],e[1])}));var r=new O.render,c=n.append("g"),o=h.zoom().on("zoom",(function(){c.attr("transform",h.event.transform)}));n.call(o),r(h.select("svg g"),a);var i=(Number(n.attr("width"))-(a.graph().width||0))/2;c.attr("transform","translate(".concat(Number.isNaN(i)?0:i,", 20)"))}}),[e,t]),Object(a.jsx)(o.Fragment,{children:Object(a.jsx)("svg",{className:"d3-component mottv-derby-family",width:"100%",height:"70vh",ref:e})})},v=function(){return Object(a.jsxs)(m.a,{children:[Object(a.jsx)(b.a,{variant:"h4",children:"\u7cfb\u56f3"}),Object(a.jsx)(j.a,{children:Object(a.jsx)(x,{})})]})},g=function(){return Object(a.jsx)("h2",{children:"404 NOT FOUND"})},w=t(519),N=t(509),y=t(510),k=t(516),M=t(520),C=t(52),E=t(512),S=t(511),T=t(54),F=Object(T.b)({name:"horseDefs",initialState:{list:[]},reducers:{init:function(){},set:function(e,n){e.list=n.payload.list}}}),U=F.actions,D=F.reducer,A=t(169),I=t.n(A),z=t(243),H=t(517),L=t(253),R=t(251),G=t(89),P=t(55),B=Object(T.b)({name:"indicator",initialState:{awaits:{}},reducers:{set:function(e,n){e.awaits=n.payload},open:function(e,n){var t=n.payload;e.awaits=Object(P.a)(Object(P.a)({},e.awaits),{},Object(G.a)({},t,1+(t in e.awaits?e.awaits[t]:0)))},close:function(e,n){var t=n.payload;if(t in e.awaits){var a=e.awaits,r=a[t],c=Object(L.a)(a,[t].map(R.a));e.awaits=Object(P.a)(Object(P.a)({},c),r>1?Object(G.a)({},t,r-1):{})}else console.warn("there isnt key [".concat(t,"] in "))}}}),J=B.actions,V=B.reducer,W=t(522),_=t(131),K=t(496),Y=t(254),$=J.open,q=J.close,Q=t(497),X=t(474),Z=t(498),ee=Object(Q.a)((function(e){return{backdrop:{zIndex:e.zIndex.drawer+1,color:"#fff"}}})),ne=function(){var e=ee(),n=Object(p.c)((function(e){return e.indicator})).awaits,t=Object(o.useMemo)((function(){return Object.values(n).some((function(e){return e>0}))}),[n]);return Object(a.jsx)(X.a,{className:e.backdrop,open:t,children:Object(a.jsx)(Z.a,{color:"inherit"})})},te=t(91),ae=t(130),re=t(499),ce=t(250),oe=t(500),ie=t(523),le={Uk:{label:"\u4e0d\u660e(\u6307\u5b9a\u306a\u3057)"},Ec:{label:"\u30a8\u30af\u30ea\u30d7\u30b9"},Ph:{label:"\u30d5\u30a1\u30e9\u30ea\u30b9"},Ns:{label:"\u30ca\u30b9\u30eb\u30fc\u30e9"},Ro:{label:"\u30ed\u30a4\u30e4\u30eb\u30c1\u30e3\u30fc\u30b8\u30e3\u30fc"},Ne:{label:"\u30cb\u30a2\u30fc\u30af\u30c6\u30a3\u30c3\u30af"},Na:{label:"\u30cd\u30a4\u30c6\u30a3\u30f4\u30c0\u30f3\u30b5\u30fc"},Fa:{label:"\u30d5\u30a7\u30a2\u30a6\u30a7\u30a4"},To:{label:"\u30c8\u30e0\u30d5\u30fc\u30eb"},Te:{label:"\u30c6\u30c7\u30a3"},Sw:{label:"\u30b9\u30a4\u30f3\u30d5\u30a9\u30fc\u30c9"},Ha:{label:"\u30cf\u30f3\u30d7\u30c8\u30f3"},Hi:{label:"\u30d2\u30e0\u30e4\u30fc"},St:{label:"\u30bb\u30f3\u30c8\u30b5\u30a4\u30e2\u30f3"},Ma:{label:"\u30de\u30c3\u30c1\u30a7\u30e0"},He:{label:"\u30d8\u30ed\u30c9"}},se=function e(n,t){var a,r,c,o,i,l,s=t.sex,u=t.listed,f=t.childName,d=null!==(a=n.name)&&void 0!==a?a:"".concat(f).concat("female"===s?"\u6bcd":"male"===s?"\u7236":"\u89aa"),m=void 0!==n.name,b=n.father?e(n.father,{sex:"male",childName:d}):[],j=n.mother?e(n.mother,{sex:"female",childName:d}):[];return[{name:d,line:null!==(r=null!==(c=n.line)&&void 0!==c?c:null===b||void 0===b||null===(o=b[0])||void 0===o?void 0:o.line)&&void 0!==r?r:"Uk",listed:!!u,owned:!1,show:m,fatherName:null===b||void 0===b||null===(i=b[0])||void 0===i?void 0:i.name,motherName:null===j||void 0===j||null===(l=j[0])||void 0===l?void 0:l.name,memo:[],sex:s},b,j].flat()},ue=function(){return fetch("".concat("/motty-derby","/assets/horse-defs.json")).then((function(e){return e.json()})).then((function(e){return e.filter((function(e){return!e.removed})).map((function(e){var n;return Object(P.a)(Object(P.a)({},e),{},{listed:!!e.listed,owned:!0,show:!0,memo:null!==(n=e.memo)&&void 0!==n?n:[]})}))}))},fe=function(){return fetch("".concat("/motty-derby","/assets/broodmares.json")).then((function(e){return e.json()})).then((function(e){return e.map((function(e){return se(e,{sex:"female",listed:!0,childName:"N/A"})})).flat()}))},de=function(){return fetch("".concat("/motty-derby","/assets/stallions.json")).then((function(e){return e.json()})).then((function(e){return e.map((function(e){return se(e,{sex:"male",listed:!0,childName:"N/A"})})).flat()}))},me=Object(H.a)((function(e){return e.ofType(U.init.type).pipe((n="horse-defs/fetch",t=Object(z.a)(I.a.mark((function e(){return I.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=U,e.next=3,Object(_.a)(ue,de,fe).pipe(Object(Y.a)((function(e){return e()})),Object(ae.a)(),Object(re.a)((function(e){return e.name})),Object(Y.a)((function(e){return e.pipe(Object(ce.a)((function(e,n){var t,a,r,c;return{name:null!==(t=e.name)&&void 0!==t?t:n.name,sex:null!==(a=e.sex)&&void 0!==a?a:n.sex,listed:e.listed||n.listed,show:e.show||n.show,owned:e.owned||n.owned,line:"Uk"===e.line?n.line:e.line,memo:[].concat(Object(te.a)(e.memo),Object(te.a)(n.memo)),fatherName:null!==(r=e.fatherName)&&void 0!==r?r:n.fatherName,motherName:null!==(c=e.motherName)&&void 0!==c?c:n.motherName}})))})),Object(oe.a)(),Object(ie.a)((function(e){var n=new Map(e.map((function(e){return[e.name,e]})));e.forEach((function e(t){var a,r;t.line&&"Uk"!==t.line||(t.fatherName&&(n.has(t.fatherName)?e(n.get(t.fatherName)):console.warn("".concat(t.fatherName,": father of ").concat(t.name," doesnt exist in list"),t,n)),t.line=null!==(a=null===(r=n.get(t.fatherName))||void 0===r?void 0:r.line)&&void 0!==a?a:"Uk","Uk"===t.line&&console.warn("couldnt determine line of ".concat(t.name)))}))}))).toPromise();case 3:return e.t1=e.sent,e.t2={list:e.t1},e.abrupt("return",e.t0.set.call(e.t0,e.t2));case 6:case"end":return e.stop()}}),e)}))),function(e){return e.pipe(Object(Y.a)((function(e){return Object(W.a)(Object(_.a)($(n)),Object(K.a)((function(){return t(e)})),Object(_.a)(q(n)))})))}));var n,t})),be=t(518),je=t(524),he=t(508),Oe=t(246),pe=t.n(Oe),xe=t(247),ve=t.n(xe),ge=t(248),we=t.n(ge),Ne=t(245),ye=t.n(Ne),ke=t(170),Me=t(171),Ce=Object(T.b)({name:"pedigree",initialState:{displays:[]},reducers:{set:function(e,n){e.displays=n.payload},push:function(e,n){var t=n.payload;e.displays.push(t)},pop:function(e,n){e.displays.length<=0?console.warn("pedigree list is empty"):e.displays.pop()},clear:function(e,n){e.displays=[]}}}),Ee=Ce.actions,Se=Ce.reducer,Te=t(506),Fe=t(507),Ue=t(501),De=t(502),Ae=t(503),Ie=t(504),ze=t(505),He=Object(Q.a)((function(e){return Object(be.a)({table:{"& .cell":{backgroundColor:"gray","&.empty":{backgroundColor:"lightgray"},"&.Ec":{backgroundColor:"#ffffff"},"&.Ph":{backgroundColor:"#cfe8ff"},"&.Ns":{backgroundColor:"#00bb00"},"&.Ro":{backgroundColor:"#ffb4c8"},"&.Ne":{backgroundColor:"#fdf488"},"&.Na":{backgroundColor:"#52d8fd"},"&.Fa":{backgroundColor:"#ffc943"},"&.To":{backgroundColor:"#ff9d4b"},"&.Te":{color:e.palette.primary.contrastText,backgroundColor:"#9e57ff"},"&.Sw":{backgroundColor:"#ffe0e1"},"&.Ha":{backgroundColor:"#90ee71"},"&.Hi":{color:e.palette.primary.contrastText,backgroundColor:"#2c6aff"},"&.St":{backgroundColor:"#9e93ff"},"&.Ma":{backgroundColor:"#c5b2fe"},"&.He":{backgroundColor:"#b9f8ff"},"&.mother":{color:e.palette.primary.contrastText,backgroundColor:"#dd7165"}}}})})),Le=function(e){return Object(a.jsx)(o.Fragment,{children:e.map((function(e,n){return Object(a.jsxs)(De.a,{children:[e.filter((function(e,n){return n>0})).map((function(e,t){return function(e,n,t){var r=Math.pow(2,5-n-2),c=["cell",t.show?t.line:"empty",0===n&&e===Math.pow(2,3)?["mother"]:[]].flatMap((function(e){return e})).join(" ");return Object(a.jsx)(o.Fragment,{children:e%r===0?Object(a.jsx)(Ue.a,{rowSpan:r,className:c,children:t.show?Object(a.jsx)(b.a,{variant:"body2",children:t.name}):null}):null},"col-".concat(n))}(n,t,e)})),n%2===0?(t=e[e.length-1].line,"Uk"!==t?Object(a.jsx)(Ue.a,{className:["cell",t].join(" "),rowSpan:2,children:Object(a.jsxs)(b.a,{variant:"body2",children:[le[t].label,"\u7cfb"]})},"col-line"):Object(a.jsx)(Ue.a,{className:["cell","empty"].join(" "),rowSpan:2},"col-line")):null]},"row-".concat(n));var t}))})},Re=function(e){var n=e.def,t=He(),r=Object(p.c)((function(e){return e.horseDefs.list})),c=function(e){return function(n){for(var t=new Array,a=0;a<Math.pow(2,4);++a){for(var r=new Array,c=0;c<5;++c)r.push({name:"empty",generation:c,show:!1,line:"Uk"});t.push(r)}return function n(a,r,c){t[a][r]={name:c.name,generation:r,show:!!c.show,line:c.line},r+1<5&&(c.fatherName&&(e.has(c.fatherName)?n(a,r+1,e.get(c.fatherName)):n(a,r+1,{name:c.fatherName,sex:"male",line:"Uk",listed:!1,show:!0,owned:!1,memo:["\u672a\u5b9a\u7fa9"]})),c.motherName&&(e.has(c.motherName)?n(a+Math.pow(2,5-r-2),r+1,e.get(c.motherName)):n(a+Math.pow(2,5-r-2),r+1,{name:c.motherName,sex:"female",line:"Uk",listed:!1,show:!0,owned:!1,memo:["\u672a\u5b9a\u7fa9"]})))}(0,0,n),t}}(Object(o.useMemo)((function(){return r.reduce((function(e,n){return e.set(n.name,n)}),new Map)}),[r]))(n);return Object(a.jsx)(Ae.a,{component:j.a,children:Object(a.jsx)(Ie.a,{className:t.table,size:"small",children:Object(a.jsx)(ze.a,{children:Le(c)})})})},Ge=function(){var e=Object(p.b)(),n=Object(p.c)((function(e){return e.pedigree})).displays,t=Object(o.useMemo)((function(){return n.length>0}),[n]),r=Object(p.c)((function(e){return e.horseDefs.list})),c=Object(o.useMemo)((function(){return n.length>0?r.find((function(e){return e.name===n[n.length-1]})):void 0}),[r,n]),i=Object(o.useMemo)((function(){return function(){e(Ee.clear())}}),[e]);return c?Object(a.jsxs)(Te.a,{open:t,onClose:i,children:[Object(a.jsxs)(Fe.a,{children:[Object(a.jsxs)(b.a,{variant:"h5",children:["\u8840\u7d71\u8868: ",c.name]}),"Uk"!==c.line?Object(a.jsxs)(b.a,{variant:"h6",style:{paddingLeft:"1em"},children:[le[c.line].label,"\u7cfb"]}):null]}),Object(a.jsx)(Re,{def:c})]}):null},Pe=Object(Q.a)((function(e){return Object(be.a)({root:{"& .name":{marginLeft:e.spacing(.5)},"& .father":{marginLeft:e.spacing(1)},"& .male":{color:"#2196f3"},"& .female":{color:"#f44336"}}})})),Be=function(e){var n=e.name,t=Object(p.b)(),r=Object(o.useMemo)((function(){return function(){t(Ee.push(n))}}),[t,n]);return Object(a.jsx)(k.a,{"aria-label":"horse info",size:"small",onClick:r,children:Object(a.jsx)(ye.a,{fontSize:"inherit"})})},Je=function(e){var n=new Map,t=function(e){return n.has(e)?n.get(e):function(){var t={id:e,label:Object(a.jsx)(o.Fragment,{}),children:[],owned:!1};return n.set(e,t),t}()};return e.forEach((function(e){var n=t(e.name);(function(e,n){var t,r;e.owned=e.owned||n.owned,e.className=[n.sex].join(" "),e.label=Object(a.jsxs)(o.Fragment,{children:[function(){switch(n.sex){case"male":return Object(a.jsx)(ke.a,{icon:Me.a});case"female":return Object(a.jsx)(ke.a,{icon:Me.b});case"unknown":return null;default:n.sex}}(),Object(a.jsxs)("span",{className:"name",children:[n.name,Object(a.jsx)(Be,{name:n.name})]}),n.fatherName?Object(a.jsxs)("span",{className:"father male",children:["(",n.fatherName,")"]}):null]}),e.fatherName=null!==(t=n.fatherName)&&void 0!==t?t:e.fatherName,e.motherName=null!==(r=n.motherName)&&void 0!==r?r:e.fatherName}(n,e),e.motherName)&&t(e.motherName).children.push(n)})),{nodes:Array.from(n.values()).filter((function(e){var t;return e.owned&&(!e.motherName||!n.has(e.motherName)||n.has(e.motherName)&&!(null===(t=n.get(e.motherName))||void 0===t?void 0:t.owned))})),ids:Array.from(n.keys())}},Ve=function e(n){return function(t){return Object(a.jsx)(je.a,{className:t.className,nodeId:t.id,label:t.label,onIconClick:n(t),children:t.children.map(e(n))},t.id)}},We=function(){var e=Pe(),n=Object(p.b)(),t=Object(o.useState)([]),r=Object(u.a)(t,2),c=r[0],i=r[1],l=Object(p.c)((function(e){return e.horseDefs.list})),s=Object(o.useMemo)((function(){return l.length>0?function(e){return function(n){return function(t){try{return e($(n)),t()}finally{e(q(n))}}}}(n)("mare-line/init")((function(){return Je(l)})):{nodes:[],ids:[]}}),[n,l]),f=s.nodes,d=s.ids;Object(o.useEffect)((function(){i(d)}),[i,d]);var m=Object(o.useMemo)((function(){return function(e){return function(n){i(c.includes(e.id)?c.filter((function(n){return n!==e.id})):[].concat(Object(te.a)(c),[e.id]))}}}),[c,i]);return Object(a.jsx)(o.Fragment,{children:Object(a.jsx)(he.a,{className:e.root,expanded:c,defaultCollapseIcon:Object(a.jsx)(pe.a,{}),defaultExpandIcon:Object(a.jsx)(ve.a,{}),defaultEndIcon:Object(a.jsx)(we.a,{}),children:f.map(Ve(m))})})},_e=function(){return Object(a.jsxs)(o.Fragment,{children:[Object(a.jsx)(b.a,{variant:"h4",children:"\u725d\u7cfb\u56f3"}),Object(a.jsx)(j.a,{children:Object(a.jsx)(We,{})})]})},Ke=(t(470),function(e){return Object(a.jsx)(b.a,{children:Object(a.jsx)(d.b,{to:e.path,children:e.label})})}),Ye=function(e){var n=e.toggleMenu;return Object(a.jsx)(w.a,{onClick:n,onKeyDown:n,children:[{label:"\u725d\u7cfb\u56f3",path:"/mare-line"},{label:"\u5bb6\u7cfb\u56f3(\u65e7)",path:"/family"}].map(Ke)})},$e=function(){var e=Object(o.useState)(!1),n=Object(u.a)(e,2),t=n[0],r=n[1],c=Object(o.useMemo)((function(){return function(){r(!t)}}),[t,r]);return Object(a.jsxs)(i.a.Fragment,{children:[Object(a.jsx)(N.a,{position:"static",children:Object(a.jsxs)(y.a,{children:[Object(a.jsx)(k.a,{edge:"start",color:"inherit","aria-label":"menu",onClick:c,children:Object(a.jsx)(S.a,{})}),Object(a.jsx)(b.a,{variant:"h6",children:"MOTTV Derby"})]})}),Object(a.jsx)(M.a,{open:t,onClose:c,children:Object(a.jsx)(Ye,{toggleMenu:c})})]})},qe=function(){var e=Object(C.a)();return Object(a.jsx)(m.a,{display:"flex",justifyContent:"flex-end",margin:e.spacing(.2),children:Object(a.jsx)(E.a,{href:"https://www.youtube.com/user/MOTTYGAMES/",target:"__blank",children:"MOTTV"})})},Qe=function(){var e=Object(C.a)(),n=Object(p.b)();return Object(o.useEffect)((function(){n(U.init())}),[n]),Object(a.jsx)(d.a,{basename:"/motty-derby",children:Object(a.jsxs)(i.a.Fragment,{children:[Object(a.jsx)($e,{}),Object(a.jsx)(m.a,{margin:e.spacing(.5),children:Object(a.jsxs)(f.d,{children:[Object(a.jsx)(f.b,{path:"/family",children:Object(a.jsx)(v,{})}),Object(a.jsx)(f.b,{path:"/mare-line",children:Object(a.jsx)(_e,{})}),Object(a.jsx)(f.b,{exact:!0,path:"/",children:Object(a.jsx)(f.a,{to:"/mare-line"})}),Object(a.jsx)(f.b,{children:Object(a.jsx)(g,{})})]})}),Object(a.jsx)(qe,{}),Object(a.jsx)(Ge,{}),Object(a.jsx)(ne,{})]})})},Xe=t(514),Ze=Object(Xe.a)({dependencies:{}}),en=Object(T.a)({reducer:{horseDefs:D,indicator:V,pedigree:Se},middleware:function(e){return e({thunk:!1}).concat([Ze])}});Ze.run(Object(H.a)(me));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var nn=Object(r.a)({});s.a.render(Object(a.jsx)(i.a.StrictMode,{children:Object(a.jsx)(c.a,{theme:nn,children:Object(a.jsx)(p.a,{store:en,children:Object(a.jsx)(Qe,{})})})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[472,1,2]]]);
//# sourceMappingURL=main.8aee2cdd.chunk.js.map