(this["webpackJsonpmotty-derby"]=this["webpackJsonpmotty-derby"]||[]).push([[0],{312:function(e,n,t){},499:function(e,n,t){},583:function(e,n,t){},585:function(e,n,t){"use strict";t.r(n);var a=t(2),r=t(288),c=t(632),o=t(0),i=t.n(o),s=t(13),l=t.n(s),u=(t(312),t(158)),f=t(11),b=t(156),j=t(634),d=t(88),m=t(296),h=t(86),O=t(196),p=(t(499),t(17)),x=function(){var e=Object(o.useRef)(null),n=Object(p.c)((function(e){return e.horseDefs.list})),t=Object(o.useMemo)((function(){return function(e){var n=new Map,t=[];return e.forEach((function(e){(e.owned||e.listed)&&(n.set(e.name,{label:e.name,class:"owned ".concat(e.sex)}),e.motherName&&(n.has(e.motherName)||n.set(e.motherName,{label:e.motherName,class:"anothers female"}),t.push([{v:e.motherName,w:e.name},{class:"mother"}])),e.fatherName&&(n.has(e.fatherName)||n.set(e.fatherName,{label:e.fatherName,class:"anothers male"}),t.push([{v:e.fatherName,w:e.name},{class:"father"}])))})),{nodes:Array.from(n.entries()),edges:t}}(n)}),[n]);return Object(o.useEffect)((function(){var n=h.select(e.current);if(n.selectAll("g").remove(),0!==t.nodes.length||0!==t.edges.length){var a=(new O.graphlib.Graph).setGraph({rankdir:"LR"}).setDefaultEdgeLabel((function(){return{}}));t.nodes.forEach((function(e){a.setNode(e[0],e[1])})),a.nodes().forEach((function(e){var n=a.node(e);n.rx=n.ry=5})),t.edges.forEach((function(e){a.setEdge(e[0],e[1])}));var r=new O.render,c=n.append("g"),o=h.zoom().on("zoom",(function(){c.attr("transform",h.event.transform)}));n.call(o),r(h.select("svg g"),a);var i=(Number(n.attr("width"))-(a.graph().width||0))/2;c.attr("transform","translate(".concat(Number.isNaN(i)?0:i,", 20)"))}}),[e,t]),Object(a.jsx)(o.Fragment,{children:Object(a.jsx)("svg",{className:"d3-component mottv-derby-family",width:"100%",height:"70vh",ref:e})})},g=function(){return Object(a.jsxs)(j.a,{children:[Object(a.jsx)(d.a,{variant:"h4",children:"\u7cfb\u56f3"}),Object(a.jsx)(m.a,{children:Object(a.jsx)(x,{})})]})},v=function(){return Object(a.jsx)("h2",{children:"404 NOT FOUND"})},w=t(621),N=t(622),y=t(623),k=t(627),M=t(628),C=t(629),E=t(619),S=t(637),T=t(60),F=t(631),U=t(624),D=t(625),A=t(626),I=t(630),z=t(41),L=Object(z.b)({name:"horseDefs",initialState:{list:[]},reducers:{init:function(){},set:function(e,n){e.list=n.payload.list}}}),H=L.actions,R=L.reducer,G=t(83),P=t.n(G),B=t(142),J=t(635),V=t(292),W=t(290),_=t(102),K=t(62),Y=Object(z.b)({name:"indicator",initialState:{awaits:{}},reducers:{set:function(e,n){e.awaits=n.payload},open:function(e,n){var t=n.payload;e.awaits=Object(K.a)(Object(K.a)({},e.awaits),{},Object(_.a)({},t,1+(t in e.awaits?e.awaits[t]:0)))},close:function(e,n){var t=n.payload;if(t in e.awaits){var a=e.awaits,r=a[t],c=Object(V.a)(a,[t].map(W.a));e.awaits=Object(K.a)(Object(K.a)({},c),r>1?Object(_.a)({},t,r-1):{})}else console.warn("there isnt key [".concat(t,"] in "))}}}),$=Y.actions,q=Y.reducer,Q=t(639),X=t(150),Z=t(607),ee=t(293),ne=$.open,te=$.close,ae=function(e,n){return function(t){return t.pipe(Object(ee.a)((function(t){return Object(Q.a)(Object(X.a)(ne(e)),Object(Z.a)((function(){return n(t)})),Object(X.a)(te(e)))})))}},re=t(608),ce=t(587),oe=t(609),ie=Object(re.a)((function(e){return{backdrop:{zIndex:e.zIndex.drawer+1,color:"#fff"}}})),se=function(){var e=ie(),n=Object(p.c)((function(e){return e.indicator})).awaits,t=Object(o.useMemo)((function(){return Object.values(n).some((function(e){return e>0}))}),[n]);return Object(a.jsx)(ce.a,{className:e.backdrop,open:t,children:Object(a.jsx)(oe.a,{color:"inherit"})})},le=t(104),ue=t(149),fe=t(610),be=t(289),je=t(611),de=t(640),me={Uk:{label:"\u4e0d\u660e(\u6307\u5b9a\u306a\u3057)"},Ec:{label:"\u30a8\u30af\u30ea\u30d7\u30b9"},Ph:{label:"\u30d5\u30a1\u30e9\u30ea\u30b9"},Ns:{label:"\u30ca\u30b9\u30eb\u30fc\u30e9"},Ro:{label:"\u30ed\u30a4\u30e4\u30eb\u30c1\u30e3\u30fc\u30b8\u30e3\u30fc"},Ne:{label:"\u30cb\u30a2\u30fc\u30af\u30c6\u30a3\u30c3\u30af"},Na:{label:"\u30cd\u30a4\u30c6\u30a3\u30f4\u30c0\u30f3\u30b5\u30fc"},Fa:{label:"\u30d5\u30a7\u30a2\u30a6\u30a7\u30a4"},To:{label:"\u30c8\u30e0\u30d5\u30fc\u30eb"},Te:{label:"\u30c6\u30c7\u30a3"},Sw:{label:"\u30b9\u30a4\u30f3\u30d5\u30a9\u30fc\u30c9"},Ha:{label:"\u30cf\u30f3\u30d7\u30c8\u30f3"},Hi:{label:"\u30d2\u30e0\u30e4\u30fc"},St:{label:"\u30bb\u30f3\u30c8\u30b5\u30a4\u30e2\u30f3"},Ma:{label:"\u30de\u30c3\u30c1\u30a7\u30e0"},He:{label:"\u30d8\u30ed\u30c9"}},he=function e(n,t){var a,r,c,o,i,s,l=t.sex,u=t.listed,f=t.childName,b=null!==(a=n.name)&&void 0!==a?a:"".concat(f).concat("female"===l?"\u6bcd":"male"===l?"\u7236":"\u89aa"),j=void 0!==n.name,d=n.father?e(n.father,{sex:"male",childName:b}):[],m=n.mother?e(n.mother,{sex:"female",childName:b}):[];return[{name:b,line:null!==(r=null!==(c=n.line)&&void 0!==c?c:null===d||void 0===d||null===(o=d[0])||void 0===o?void 0:o.line)&&void 0!==r?r:"Uk",listed:!!u,owned:!1,show:j,fatherName:null===d||void 0===d||null===(i=d[0])||void 0===i?void 0:i.name,motherName:null===m||void 0===m||null===(s=m[0])||void 0===s?void 0:s.name,memo:[],sex:l},d,m].flat()},Oe=function(){return fetch("".concat("/motty-derby","/assets/horse-defs.json")).then((function(e){return e.json()})).then((function(e){return e.filter((function(e){return!e.removed})).map((function(e){var n;return Object(K.a)(Object(K.a)({},e),{},{listed:!!e.listed,owned:!0,show:!0,memo:null!==(n=e.memo)&&void 0!==n?n:[]})}))}))},pe=function(){return fetch("".concat("/motty-derby","/assets/broodmares.json")).then((function(e){return e.json()})).then((function(e){return e.map((function(e){return he(e,{sex:"female",listed:!0,childName:"N/A"})})).flat()}))},xe=function(){return fetch("".concat("/motty-derby","/assets/stallions.json")).then((function(e){return e.json()})).then((function(e){return e.map((function(e){return he(e,{sex:"male",listed:!0,childName:"N/A"})})).flat()}))},ge=Object(J.a)((function(e){return e.ofType(H.init.type).pipe(ae("horse-defs/fetch",Object(B.a)(P.a.mark((function e(){return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=H,e.next=3,Object(X.a)(Oe,xe,pe).pipe(Object(ee.a)((function(e){return e()})),Object(ue.a)(),Object(fe.a)((function(e){return e.name})),Object(ee.a)((function(e){return e.pipe(Object(be.a)((function(e,n){var t,a,r,c;return{name:null!==(t=e.name)&&void 0!==t?t:n.name,sex:null!==(a=e.sex)&&void 0!==a?a:n.sex,listed:e.listed||n.listed,show:e.show||n.show,owned:e.owned||n.owned,line:"Uk"===e.line?n.line:e.line,memo:[].concat(Object(le.a)(e.memo),Object(le.a)(n.memo)),fatherName:null!==(r=e.fatherName)&&void 0!==r?r:n.fatherName,motherName:null!==(c=e.motherName)&&void 0!==c?c:n.motherName}})))})),Object(je.a)(),Object(de.a)((function(e){var n=new Map(e.map((function(e){return[e.name,e]})));e.forEach((function e(t){var a,r;t.line&&"Uk"!==t.line||(t.fatherName&&(n.has(t.fatherName)?e(n.get(t.fatherName)):console.warn("".concat(t.fatherName,": father of ").concat(t.name," doesnt exist in list"),t,n)),t.line=null!==(a=null===(r=n.get(t.fatherName))||void 0===r?void 0:r.line)&&void 0!==a?a:"Uk","Uk"===t.line&&console.warn("couldnt determine line of ".concat(t.name)))}))}))).toPromise();case 3:return e.t1=e.sent,e.t2={list:e.t1},e.abrupt("return",e.t0.set.call(e.t0,e.t2));case 6:case"end":return e.stop()}}),e)})))))})),ve=t(636),we=t(641),Ne=t(620),ye=t(284),ke=t.n(ye),Me=t(285),Ce=t.n(Me),Ee=t(286),Se=t.n(Ee),Te=t(283),Fe=t.n(Te),Ue=t(160),De=t(161),Ae=Object(z.b)({name:"pedigree",initialState:{displays:[]},reducers:{set:function(e,n){e.displays=n.payload},push:function(e,n){var t=n.payload;e.displays.push(t)},pop:function(e,n){e.displays.length<=0?console.warn("pedigree list is empty"):e.displays.pop()},clear:function(e,n){e.displays=[]}}}),Ie=Ae.actions,ze=Ae.reducer,Le=t(617),He=t(618),Re=t(612),Ge=t(613),Pe=t(614),Be=t(615),Je=t(616),Ve=Object(re.a)((function(e){return Object(ve.a)({table:{"& .cell":{backgroundColor:"gray","&.empty":{backgroundColor:"lightgray"},"&.Ec":{backgroundColor:"#ffffff"},"&.Ph":{backgroundColor:"#cfe8ff"},"&.Ns":{backgroundColor:"#00bb00"},"&.Ro":{backgroundColor:"#ffb4c8"},"&.Ne":{backgroundColor:"#fdf488"},"&.Na":{backgroundColor:"#52d8fd"},"&.Fa":{backgroundColor:"#ffc943"},"&.To":{backgroundColor:"#ff9d4b"},"&.Te":{color:e.palette.primary.contrastText,backgroundColor:"#9e57ff"},"&.Sw":{backgroundColor:"#ffe0e1"},"&.Ha":{backgroundColor:"#90ee71"},"&.Hi":{color:e.palette.primary.contrastText,backgroundColor:"#2c6aff"},"&.St":{backgroundColor:"#9e93ff"},"&.Ma":{backgroundColor:"#c5b2fe"},"&.He":{backgroundColor:"#b9f8ff"},"&.mother":{color:e.palette.primary.contrastText,backgroundColor:"#dd7165"}}}})})),We=function(e){return Object(a.jsx)(o.Fragment,{children:e.map((function(e,n){return Object(a.jsxs)(Ge.a,{children:[e.filter((function(e,n){return n>0})).map((function(e,t){return function(e,n,t){var r=Math.pow(2,5-n-2),c=["cell",t.show?t.line:"empty",0===n&&e===Math.pow(2,3)?["mother"]:[]].flatMap((function(e){return e})).join(" ");return Object(a.jsx)(o.Fragment,{children:e%r===0?Object(a.jsx)(Re.a,{rowSpan:r,className:c,children:t.show?Object(a.jsx)(d.a,{variant:"body2",children:t.name}):null}):null},"col-".concat(n))}(n,t,e)})),n%2===0?(t=e[e.length-1].line,"Uk"!==t?Object(a.jsx)(Re.a,{className:["cell",t].join(" "),rowSpan:2,children:Object(a.jsxs)(d.a,{variant:"body2",children:[me[t].label,"\u7cfb"]})},"col-line"):Object(a.jsx)(Re.a,{className:["cell","empty"].join(" "),rowSpan:2},"col-line")):null]},"row-".concat(n));var t}))})},_e=function(e){var n=e.def,t=Ve(),r=Object(p.c)((function(e){return e.horseDefs.list})),c=function(e){return function(n){for(var t=new Array,a=0;a<Math.pow(2,4);++a){for(var r=new Array,c=0;c<5;++c)r.push({name:"empty",generation:c,show:!1,line:"Uk"});t.push(r)}return function n(a,r,c){t[a][r]={name:c.name,generation:r,show:!!c.show,line:c.line},r+1<5&&(c.fatherName&&(e.has(c.fatherName)?n(a,r+1,e.get(c.fatherName)):n(a,r+1,{name:c.fatherName,sex:"male",line:"Uk",listed:!1,show:!0,owned:!1,memo:["\u672a\u5b9a\u7fa9"]})),c.motherName&&(e.has(c.motherName)?n(a+Math.pow(2,5-r-2),r+1,e.get(c.motherName)):n(a+Math.pow(2,5-r-2),r+1,{name:c.motherName,sex:"female",line:"Uk",listed:!1,show:!0,owned:!1,memo:["\u672a\u5b9a\u7fa9"]})))}(0,0,n),t}}(Object(o.useMemo)((function(){return r.reduce((function(e,n){return e.set(n.name,n)}),new Map)}),[r]))(n);return Object(a.jsx)(Pe.a,{component:m.a,children:Object(a.jsx)(Be.a,{className:t.table,size:"small",children:Object(a.jsx)(Je.a,{children:We(c)})})})},Ke=function(){var e=Object(p.b)(),n=Object(p.c)((function(e){return e.pedigree})).displays,t=Object(o.useMemo)((function(){return n.length>0}),[n]),r=Object(p.c)((function(e){return e.horseDefs.list})),c=Object(o.useMemo)((function(){return n.length>0?r.find((function(e){return e.name===n[n.length-1]})):void 0}),[r,n]),i=Object(o.useMemo)((function(){return function(){e(Ie.clear())}}),[e]);return c?Object(a.jsxs)(Le.a,{open:t,onClose:i,children:[Object(a.jsxs)(He.a,{children:[Object(a.jsxs)(d.a,{variant:"h5",children:["\u8840\u7d71\u8868: ",c.name]}),"Uk"!==c.line?Object(a.jsxs)(d.a,{variant:"h6",style:{paddingLeft:"1em"},children:["\u5927\u7cfb\u7d71: ",me[c.line].label,"\u7cfb"]}):null]}),Object(a.jsx)(_e,{def:c})]}):null},Ye=Object(re.a)((function(e){return Object(ve.a)({root:{"& .name":{marginLeft:e.spacing(.5)},"& .father":{marginLeft:e.spacing(1)},"& .male":{color:"#2196f3"},"& .female":{color:"#f44336"},"& .unknown":{color:"#888888"}}})})),$e=function(e){var n=e.name,t=Object(p.b)(),r=Object(o.useMemo)((function(){return function(){t(Ie.push(n))}}),[t,n]);return Object(a.jsx)(E.a,{"aria-label":"horse info",size:"small",onClick:r,children:Object(a.jsx)(Fe.a,{fontSize:"inherit"})})},qe=function(e){var n=new Map,t=function(e){return n.has(e)?n.get(e):function(){var t={id:e,label:Object(a.jsx)(o.Fragment,{}),children:[],owned:!1};return n.set(e,t),t}()};return e.forEach((function(e){var n=t(e.name);(function(e,n){var t,r;e.owned=e.owned||n.owned,e.className=[n.sex].join(" "),e.label=Object(a.jsxs)(o.Fragment,{children:[function(){switch(n.sex){case"male":return Object(a.jsx)(Ue.a,{icon:De.a});case"female":return Object(a.jsx)(Ue.a,{icon:De.c});case"unknown":return Object(a.jsx)(Ue.a,{icon:De.b});default:n.sex}}(),Object(a.jsxs)("span",{className:"name",children:[n.name,Object(a.jsx)($e,{name:n.name})]}),n.fatherName?Object(a.jsxs)(o.Fragment,{children:["(",Object(a.jsxs)("span",{className:"father male",children:[n.fatherName,Object(a.jsx)($e,{name:n.fatherName})]}),")"]}):null]}),e.fatherName=null!==(t=n.fatherName)&&void 0!==t?t:e.fatherName,e.motherName=null!==(r=n.motherName)&&void 0!==r?r:e.fatherName}(n,e),e.motherName)&&t(e.motherName).children.push(n)})),{nodes:Array.from(n.values()).filter((function(e){var t;return e.owned&&(!e.motherName||!n.has(e.motherName)||n.has(e.motherName)&&!(null===(t=n.get(e.motherName))||void 0===t?void 0:t.owned))})),ids:Array.from(n.keys())}},Qe=function e(n){return function(t){return Object(a.jsx)(we.a,{className:t.className,nodeId:t.id,label:t.label,onIconClick:n(t),children:t.children.map(e(n))},t.id)}},Xe=function(){var e=Ye(),n=Object(p.b)(),t=Object(o.useState)([]),r=Object(u.a)(t,2),c=r[0],i=r[1],s=Object(p.c)((function(e){return e.horseDefs.list})),l=Object(o.useMemo)((function(){return s.length>0?function(e){return function(n){return function(t){try{return e(ne(n)),t()}finally{e(te(n))}}}}(n)("mare-line/init")((function(){return qe(s)})):{nodes:[],ids:[]}}),[n,s]),f=l.nodes,b=l.ids;Object(o.useEffect)((function(){i(b)}),[i,b]);var j=Object(o.useMemo)((function(){return function(e){return function(n){i(c.includes(e.id)?c.filter((function(n){return n!==e.id})):[].concat(Object(le.a)(c),[e.id]))}}}),[c,i]);return Object(a.jsx)(o.Fragment,{children:Object(a.jsx)(Ne.a,{className:e.root,expanded:c,defaultCollapseIcon:Object(a.jsx)(ke.a,{}),defaultExpandIcon:Object(a.jsx)(Ce.a,{}),defaultEndIcon:Object(a.jsx)(Se.a,{}),children:f.map(Qe(j))})})},Ze=Object(re.a)((function(e){return Object(ve.a)({paper:{padding:e.spacing(2)}})})),en=function(){var e=Ze();return Object(a.jsxs)(o.Fragment,{children:[Object(a.jsx)(d.a,{variant:"h4",children:"\u725d\u7cfb\u56f3"}),Object(a.jsx)(m.a,{className:e.paper,children:Object(a.jsx)(Xe,{})})]})},nn=t(287),tn=t.n(nn),an=(t(582),Object(re.a)((function(e){return Object(ve.a)({paper:{padding:e.spacing(1)}})}))),rn=function(){var e=an(),n=Object(p.b)(),t=Object(p.c)((function(e){return e.changeLog})).article;return Object(o.useEffect)((function(){n(on.init())}),[n]),Object(a.jsx)(o.Fragment,{children:Object(a.jsx)(m.a,{className:e.paper,children:""!==t?Object(a.jsx)(tn.a,{source:t,className:"markdown-body"}):null})})},cn=Object(z.b)({name:"change-log",initialState:{article:""},reducers:{init:function(){},set:function(e,n){e.article=n.payload}}}),on=cn.actions,sn=cn.reducer,ln=Object(J.a)((function(e){return e.ofType(on.init.type).pipe(ae("change-logs/fetch",Object(B.a)(P.a.mark((function e(){return P.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=on,e.next=3,fetch("".concat("/motty-derby","/assets/change-log.md")).then((function(e){return e.text()}));case 3:return e.t1=e.sent,e.abrupt("return",e.t0.set.call(e.t0,e.t1));case 5:case"end":return e.stop()}}),e)})))))})),un=(t(583),function(e){return Object(a.jsxs)(w.a,{button:!0,component:b.b,to:e.path,children:[Object(a.jsx)(N.a,{children:e.icon}),Object(a.jsx)(y.a,{primary:e.label})]},e.path)}),fn=[{icon:Object(a.jsx)(U.a,{}),label:"\u725d\u7cfb\u56f3",path:"/mare-line",page:Object(a.jsx)(en,{})},{icon:Object(a.jsx)(D.a,{}),label:"\u5bb6\u7cfb\u56f3(\u65e7)",path:"/family",page:Object(a.jsx)(g,{})},{icon:Object(a.jsx)(A.a,{}),label:"\u66f4\u65b0\u5c65\u6b74",path:"/change-log",page:Object(a.jsx)(rn,{})}],bn=function(e){var n=e.toggleMenu;return Object(a.jsx)(k.a,{onClick:n,onKeyDown:n,children:fn.map(un)})},jn=function(){var e=Object(o.useState)(!1),n=Object(u.a)(e,2),t=n[0],r=n[1],c=Object(o.useMemo)((function(){return function(){r(!t)}}),[t,r]);return Object(a.jsxs)(i.a.Fragment,{children:[Object(a.jsx)(M.a,{position:"static",children:Object(a.jsxs)(C.a,{children:[Object(a.jsx)(E.a,{edge:"start",color:"inherit","aria-label":"menu",onClick:c,children:Object(a.jsx)(I.a,{})}),Object(a.jsx)(d.a,{variant:"h6",children:"MOTTV Derby"})]})}),Object(a.jsx)(S.a,{open:t,onClose:c,children:Object(a.jsx)(bn,{toggleMenu:c})})]})},dn=function(){var e=Object(T.a)();return Object(a.jsx)(j.a,{display:"flex",justifyContent:"flex-end",margin:e.spacing(.2),children:Object(a.jsx)(F.a,{href:"https://www.youtube.com/user/MOTTYGAMES/",target:"__blank",children:"MOTTV"})})},mn=function(){var e=Object(T.a)(),n=Object(p.b)();return Object(o.useEffect)((function(){n(H.init())}),[n]),Object(a.jsx)(b.a,{basename:"/motty-derby",children:Object(a.jsxs)(i.a.Fragment,{children:[Object(a.jsx)(jn,{}),Object(a.jsx)(j.a,{margin:e.spacing(.5),children:Object(a.jsxs)(f.d,{children:[fn.map((function(e){var n=e.path,t=e.page;return Object(a.jsx)(f.b,{path:n,children:t})})),Object(a.jsx)(f.b,{exact:!0,path:"/",children:Object(a.jsx)(f.a,{to:"/mare-line"})}),Object(a.jsx)(f.b,{children:Object(a.jsx)(v,{})})]})}),Object(a.jsx)(dn,{}),Object(a.jsx)(Ke,{}),Object(a.jsx)(se,{})]})})},hn=t(633),On=Object(hn.a)({dependencies:{}}),pn=Object(z.a)({reducer:{horseDefs:R,indicator:q,pedigree:ze,changeLog:sn},middleware:function(e){return e({thunk:!1}).concat([On])}});On.run(Object(J.a)(ge,ln));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var xn=Object(r.a)({});l.a.render(Object(a.jsx)(i.a.StrictMode,{children:Object(a.jsx)(c.a,{theme:xn,children:Object(a.jsx)(p.a,{store:pn,children:Object(a.jsx)(mn,{})})})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[585,1,2]]]);
//# sourceMappingURL=main.eae36367.chunk.js.map