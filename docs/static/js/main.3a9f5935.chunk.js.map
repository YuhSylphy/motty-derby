{"version":3,"sources":["features/family/components/FamilyDiagram.tsx","features/family/Family.tsx","features/errors/404.tsx","features/horse-defs/core/ducks.ts","features/indicator/core/ducks.ts","features/indicator/core/util.ts","features/indicator/components/Indicator.tsx","features/horse-defs/core/epic.ts","features/horse-defs/core/horse.ts","features/mare-line/components/MareLineTree.tsx","features/mare-line/components/MareLine.tsx","App.tsx","app/store.ts","serviceWorker.ts","index.tsx"],"names":["FamilyDiagram","d3Container","useRef","defs","useSelector","state","horseDefs","list","data","useMemo","nodes","Map","edges","forEach","def","set","name","label","class","sex","motherName","has","push","v","w","fatherName","Array","from","entries","prepareGraph","useEffect","svg","d3","current","selectAll","remove","length","g","dagreD3","Graph","setGraph","rankdir","setDefaultEdgeLabel","n","setNode","node","rx","ry","e","setEdge","render","svgGroup","append","zoom","on","attr","transform","call","xCenterOffset","Number","graph","width","isNaN","className","height","ref","Family","Box","Typography","variant","Paper","Http404","horseDefsSlice","createSlice","initialState","reducers","init","draft","action","payload","actions","reducer","slice","awaits","open","key","close","console","warn","target","rest","indicatorActions","useStyles","makeStyles","theme","backdrop","zIndex","drawer","color","Indicator","classes","indicator","waiting","Object","values","some","x","Backdrop","CircularProgress","epic","combineEpics","action$","ofType","horseDefsActions","type","pipe","input","a","fetch","process","then","res","json","mergeMap","concat","of","defer","createStyles","root","marginLeft","spacing","toggleExpand","TreeItem","nodeId","id","onIconClick","children","map","MareLineTree","dispatch","useDispatch","useState","expanded","setExpanded","func","withIndicatorSync","roots","Set","fetchOrCreateNode","get","created","join","icon","faMars","faVenus","add","ids","keys","construct","event","includes","filter","TreeView","defaultCollapseIcon","defaultExpandIcon","defaultEndIcon","MareLine","renderListItem","to","path","MenuList","toggleMenu","List","onClick","onKeyDown","Header","menuOpen","setMenuOpen","Fragment","AppBar","position","Toolbar","IconButton","edge","aria-label","MenuOutlined","Drawer","onClose","Footer","useTheme","display","justifyContent","margin","href","App","basename","exact","epicMiddleware","createEpicMiddleware","dependencies","store","configureStore","horseDefsReducer","indicatorReducer","middleware","getDefaultMiddleware","thunk","run","horseDefsEpic","Boolean","window","location","hostname","match","createMuiTheme","ReactDOM","StrictMode","document","getElementById","navigator","serviceWorker","ready","registration","unregister","catch","error","message"],"mappings":"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","file":"static/js/main.3a9f5935.chunk.js","sourcesContent":["import * as React from \"react\";\r\nimport { useEffect, useMemo, useRef } from \"react\";\r\nimport * as d3 from \"d3\";\r\nimport * as dagreD3 from \"dagre-d3\";\r\nimport * as graphlib from \"graphlib\";\r\n\r\nimport { HorseDef } from \"../../horse-defs/core/horse\";\r\n\r\nimport \"./FamilyDiagram.css\";\r\nimport { Edge } from \"dagre-d3\";\r\nimport { useSelector } from \"react-redux\";\r\nimport { RootState } from \"../../../app/store\";\r\n\r\nconst prepareGraph = (defs: HorseDef[]) => {\r\n  const nodes = new Map<string, dagreD3.Label>();\r\n  const edges: [Edge, dagreD3.Label][] = [];\r\n\r\n  defs.forEach((def) => {\r\n    // 定義された馬本体\r\n    nodes.set(def.name, {\r\n      label: def.name,\r\n      class: `owned ${def.sex}`,\r\n    });\r\n\r\n    // 母親\r\n    if (def.motherName) {\r\n      // 未登録なら非所持馬として追加\r\n      if (!nodes.has(def.motherName)) {\r\n        nodes.set(def.motherName, {\r\n          label: def.motherName,\r\n          class: \"anothers female\",\r\n        });\r\n      } else {\r\n        // TODO: 所持馬扱いに書き換える\r\n      }\r\n      edges.push([{ v: def.motherName, w: def.name }, { class: \"mother\" }]);\r\n    }\r\n\r\n    if (def.fatherName) {\r\n      if (!nodes.has(def.fatherName)) {\r\n        nodes.set(def.fatherName, {\r\n          label: def.fatherName,\r\n          class: \"anothers male\",\r\n        });\r\n      } else {\r\n        // TODO: 所持馬扱いに書き換える\r\n      }\r\n      edges.push([{ v: def.fatherName, w: def.name }, { class: \"father\" }]);\r\n    }\r\n  });\r\n\r\n  return { nodes: Array.from(nodes.entries()), edges };\r\n};\r\n\r\nexport const FamilyDiagram: React.FC = () => {\r\n  const d3Container = useRef<SVGSVGElement>(null!);\r\n\r\n  const defs = useSelector((state: RootState) => state.horseDefs.list);\r\n  const data = useMemo(() => prepareGraph(defs), [defs]);\r\n\r\n  useEffect(() => {\r\n    const svg = d3.select<SVGSVGElement, SVGSVGElement>(d3Container.current);\r\n    svg.selectAll(\"g\").remove();\r\n\r\n    if (data.nodes.length === 0 && data.edges.length === 0) {\r\n      return;\r\n    }\r\n\r\n    const g = new dagreD3.graphlib.Graph()\r\n      .setGraph({\r\n        rankdir: \"LR\",\r\n      })\r\n      .setDefaultEdgeLabel(() => ({}));\r\n\r\n    // Here we're setting nodeclass, which is used by our custom drawNodes function\r\n    // below.\r\n    data.nodes.forEach((n) => {\r\n      g.setNode(n[0], n[1]);\r\n    });\r\n\r\n    g.nodes().forEach(function (v) {\r\n      var node = g.node(v);\r\n      // Round the corners of the nodes\r\n      node.rx = node.ry = 5;\r\n    });\r\n\r\n    // Set up edges, no special attributes.\r\n    data.edges.forEach((e) => {\r\n      g.setEdge(e[0], e[1]);\r\n    });\r\n\r\n    // Create the renderer\r\n    var render = new dagreD3.render();\r\n    const svgGroup = svg.append(\"g\");\r\n\r\n    // Set up zoom support\r\n    const zoom = d3.zoom<SVGSVGElement, SVGSVGElement>().on(\"zoom\", () => {\r\n      svgGroup.attr(\"transform\", d3.event.transform);\r\n    });\r\n    svg.call(zoom);\r\n\r\n    // Run the renderer. This is what draws the final graph.\r\n    render(d3.select(\"svg g\"), (g as unknown) as graphlib.Graph);\r\n\r\n    // Center the graph\r\n    const xCenterOffset =\r\n      (Number(svg.attr(\"width\")) - (g.graph().width || 0)) / 2;\r\n    svgGroup.attr(\r\n      \"transform\",\r\n      `translate(${Number.isNaN(xCenterOffset) ? 0 : xCenterOffset}, 20)`\r\n    );\r\n    // svg.attr(\"height\", (g.graph().height || 0) + 40);\r\n  }, [d3Container, data]);\r\n\r\n  return (\r\n    <React.Fragment>\r\n      <svg\r\n        className=\"d3-component mottv-derby-family\"\r\n        width=\"100%\"\r\n        height=\"70vh\"\r\n        ref={d3Container}\r\n      />\r\n    </React.Fragment>\r\n  );\r\n};\r\n","import { Box, Paper, Typography } from \"@material-ui/core\";\r\nimport * as React from \"react\";\r\nimport { FamilyDiagram } from \"./components/FamilyDiagram\";\r\n\r\nexport const Family: React.FC = () => {\r\n  return (\r\n    <Box>\r\n      <Typography variant=\"h4\">系図</Typography>\r\n      <Paper>\r\n        <FamilyDiagram />\r\n      </Paper>\r\n    </Box>\r\n  );\r\n};\r\n","import * as React from 'react';\r\n\r\nexport const Http404: React.FC = () => {\r\n    return <h2>404 NOT FOUND</h2>;\r\n}\r\n","import { createSlice, PayloadAction } from \"@reduxjs/toolkit\";\r\nimport { HorseDef } from \"./horse\";\r\n\r\nexport type HorseDefState = {\r\n  list: HorseDef[];\r\n};\r\n\r\nconst horseDefsSlice = createSlice({\r\n  name: \"horseDefs\",\r\n  initialState: { list: [] as HorseDef[] },\r\n  reducers: {\r\n    init: () => {},\r\n    set: (draft, action: PayloadAction<HorseDefState>) => {\r\n      draft.list = action.payload.list;\r\n    },\r\n  },\r\n});\r\n\r\nexport const { actions, reducer } = horseDefsSlice;\r\nexport type HorseDefsAction = ReturnType<typeof actions[keyof typeof actions]>;\r\n","import { createSlice, PayloadAction } from \"@reduxjs/toolkit\";\r\n\r\nexport type IndicatorState = {\r\n  awaits: { [key: string]: number };\r\n};\r\n\r\nconst slice = createSlice({\r\n  name: \"indicator\",\r\n  initialState: { awaits: {} } as IndicatorState,\r\n  reducers: {\r\n    set: (draft, action: PayloadAction<IndicatorState[\"awaits\"]>) => {\r\n      draft.awaits = action.payload;\r\n    },\r\n    open: (draft, { payload: key }: PayloadAction<string>) => {\r\n      draft.awaits = {\r\n        ...draft.awaits,\r\n        [key]: 1 + (key in draft.awaits ? draft.awaits[key] : 0),\r\n      };\r\n    },\r\n    close: (draft, { payload: key }: PayloadAction<string>) => {\r\n      if (!(key in draft.awaits)) {\r\n        console.warn(`there isnt key [${key}] in `);\r\n      }\r\n      const { [key]: target, ...rest } = draft.awaits;\r\n      draft.awaits = {\r\n        ...rest,\r\n        ...(target > 1 ? { [key]: target - 1 } : {}),\r\n      };\r\n    },\r\n  },\r\n});\r\n\r\nexport const { actions, reducer } = slice;\r\nexport type IndicatorAction = ReturnType<typeof actions[keyof typeof actions]>;\r\n","import {\r\n  OperatorFunction,\r\n  ObservableInput,\r\n  ObservedValueOf,\r\n  of,\r\n  defer,\r\n  concat,\r\n} from \"rxjs\";\r\nimport { mergeMap } from \"rxjs/operators\";\r\nimport { Dispatch } from \"react\";\r\nimport { Action } from \"redux\";\r\nimport { indicatorActions, IndicatorAction } from \"..\";\r\n\r\nconst { open, close } = indicatorActions;\r\n// export const withIndicator = <T extends Action>(\r\n//   label: string\r\n// ): OperatorFunction<T, T | IndicatorAction> => (action$) =>\r\n//   action$.pipe(startWith(open(label)), endWith(close(label)));\r\nexport const withIndicator = <\r\n  T extends Action,\r\n  O extends ObservableInput<Action>\r\n>(\r\n  label: string,\r\n  input: (action: T) => O\r\n): OperatorFunction<T, ObservedValueOf<O> | IndicatorAction> => (action$) =>\r\n  action$.pipe(\r\n    mergeMap((action) =>\r\n      concat(\r\n        of(open(label)),\r\n        defer(() => input(action)),\r\n        of(close(label))\r\n      )\r\n    )\r\n  );\r\n//   action$.pipe(\r\n//     mergeMap((action) =>\r\n//       concat(\r\n//         of(open(label)),\r\n//         defer(() => input(action)),\r\n//         of(endWith(close(label)))\r\n//       )\r\n//     )\r\n//   );\r\n\r\nexport const withIndicatorSync = (dispatch: Dispatch<any>) => (\r\n  label: string\r\n) => <R>(func: () => R) => {\r\n  try {\r\n    dispatch(open(label));\r\n    return func();\r\n  } finally {\r\n    dispatch(close(label));\r\n  }\r\n};\r\n\r\nexport const withIndicatorAsync = (dispatch: Dispatch<any>) => (\r\n  label: string\r\n) => <R>(func: () => PromiseLike<R>) => {\r\n  return new Promise(() => {\r\n    dispatch(open(label));\r\n  })\r\n    .then(func)\r\n    .finally(() => {\r\n      dispatch(close(label));\r\n    });\r\n};\r\n","import { Backdrop, CircularProgress, makeStyles } from \"@material-ui/core\";\r\nimport React, { useMemo } from \"react\";\r\nimport { useSelector } from \"react-redux\";\r\nimport { RootState } from \"../../../app/store\";\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n  backdrop: {\r\n    zIndex: theme.zIndex.drawer + 1,\r\n    color: \"#fff\",\r\n  },\r\n}));\r\n\r\nexport const Indicator: React.FC = () => {\r\n  const classes = useStyles();\r\n  const { awaits } = useSelector((state: RootState) => state.indicator);\r\n\r\n  const waiting = useMemo(() => Object.values(awaits).some((x) => x > 0), [\r\n    awaits,\r\n  ]);\r\n\r\n  return (\r\n    <Backdrop className={classes.backdrop} open={waiting}>\r\n      <CircularProgress color=\"inherit\" />\r\n    </Backdrop>\r\n  );\r\n};\r\n","import { Epic, combineEpics } from \"redux-observable\";\r\n\r\nimport { horseDefsActions, HorseDefsAction } from \"..\";\r\nimport { withIndicator, IndicatorAction } from \"../../indicator\";\r\nimport { fetchHorseDefs } from \"./horse\";\r\n\r\nexport const fetchDefsEpic: Epic<\r\n  HorseDefsAction | IndicatorAction,\r\n  HorseDefsAction | IndicatorAction\r\n> = (action$) =>\r\n  action$\r\n    .ofType(horseDefsActions.init.type)\r\n    .pipe(\r\n      withIndicator(\"horse-defs/fetch\", async () =>\r\n        horseDefsActions.set({ list: await fetchHorseDefs() })\r\n      )\r\n    );\r\n\r\nexport const epic = combineEpics(fetchDefsEpic);\r\n","export type Sex = \"male\" | \"female\" | \"unknown\";\r\n\r\nexport type HorseDef = {\r\n  name: string;\r\n  fatherName?: string;\r\n  motherName?: string;\r\n  sex: Sex;\r\n};\r\n\r\nexport const fetchHorseDefs = (): Promise<HorseDef[]> =>\r\n  fetch(`${process.env.PUBLIC_URL}/assets/horse-defs.json`).then((res) =>\r\n    res.json()\r\n  );\r\n","import { makeStyles, createStyles, Theme } from \"@material-ui/core\";\r\nimport { TreeItem, TreeView } from \"@material-ui/lab\";\r\nimport ExpandMoreIcon from \"@material-ui/icons/ExpandMore\";\r\nimport ChevronRightIcon from \"@material-ui/icons/ChevronRight\";\r\nimport RemoveIcon from \"@material-ui/icons/Remove\";\r\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\r\nimport { faMars, faVenus } from \"@fortawesome/free-solid-svg-icons\";\r\nimport * as React from \"react\";\r\nimport { useEffect, useMemo, useState } from \"react\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport { RootState } from \"../../../app/store\";\r\nimport { HorseDef } from \"../../horse-defs/core/horse\";\r\nimport { withIndicatorSync } from \"../../indicator\";\r\n\r\ntype Datum = {\r\n  id: string;\r\n  label: JSX.Element;\r\n  className?: string;\r\n  children: Datum[];\r\n};\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n  createStyles({\r\n    root: {\r\n      \"& .name\": {\r\n        marginLeft: theme.spacing(0.5),\r\n      },\r\n      \"& .father\": {\r\n        marginLeft: theme.spacing(1),\r\n      },\r\n      \"& .male\": {\r\n        color: \"#2196f3\",\r\n      },\r\n      \"& .female\": {\r\n        color: \"#f44336\",\r\n      },\r\n    },\r\n  })\r\n);\r\n\r\nconst construct = (defs: HorseDef[]): { nodes: Datum[]; ids: string[] } => {\r\n  const roots = new Set<Datum>();\r\n  const map = new Map<string, Datum>();\r\n\r\n  const fetchOrCreateNode = (id: string) =>\r\n    map.has(id)\r\n      ? (() => {\r\n          const fetched: Datum = map.get(id)!;\r\n          return fetched;\r\n        })()\r\n      : // 新規\r\n        (() => {\r\n          const created: Datum = {\r\n            id,\r\n            label: <React.Fragment />,\r\n            children: [],\r\n          };\r\n          map.set(id, created);\r\n          return created;\r\n        })();\r\n\r\n  const append = (def: HorseDef) => {\r\n    const node = fetchOrCreateNode(def.name);\r\n\r\n    node.className = [def.sex].join(\" \");\r\n    node.label = (\r\n      <React.Fragment>\r\n        {(() => {\r\n          switch (def.sex) {\r\n            case \"male\":\r\n              return <FontAwesomeIcon icon={faMars} />;\r\n            case \"female\":\r\n              return <FontAwesomeIcon icon={faVenus} />;\r\n            case \"unknown\":\r\n              return null;\r\n            default:\r\n              const __exhaust: never = def.sex; // eslint-disable-line @typescript-eslint/no-unused-vars\r\n          }\r\n        })()}\r\n        <span className=\"name\">{def.name}</span>\r\n        {def.fatherName ? (\r\n          <span className=\"father male\">({def.fatherName})</span>\r\n        ) : null}\r\n      </React.Fragment>\r\n    );\r\n\r\n    if (def.motherName) {\r\n      const mother = fetchOrCreateNode(def.motherName);\r\n      mother.children.push(node);\r\n    } else {\r\n      roots.add(node);\r\n    }\r\n  };\r\n\r\n  defs.forEach(append);\r\n  return { nodes: Array.from(roots.values()), ids: Array.from(map.keys()) };\r\n};\r\n\r\nconst render = (toggleExpand: (node: Datum) => React.MouseEventHandler) => (\r\n  node: Datum\r\n) => {\r\n  return (\r\n    <TreeItem\r\n      className={node.className}\r\n      key={node.id}\r\n      nodeId={node.id}\r\n      label={node.label}\r\n      onIconClick={toggleExpand(node)}\r\n    >\r\n      {node.children.map(render(toggleExpand))}\r\n    </TreeItem>\r\n  );\r\n};\r\n\r\nexport const MareLineTree: React.FC = () => {\r\n  const classes = useStyles();\r\n  const dispatch = useDispatch();\r\n  const [expanded, setExpanded] = useState<string[]>([]);\r\n\r\n  const defs = useSelector((state: RootState) => state.horseDefs.list);\r\n  const { nodes, ids } = useMemo(() => {\r\n    if (defs.length > 0) {\r\n      return withIndicatorSync(dispatch)(\"mare-line/init\")(() =>\r\n        construct(defs)\r\n      );\r\n    } else {\r\n      return { nodes: [], ids: [] };\r\n    }\r\n  }, [dispatch, defs]);\r\n\r\n  useEffect(() => {\r\n    setExpanded(ids);\r\n  }, [ids]);\r\n\r\n  const toggleExpand = useMemo<(node: Datum) => React.MouseEventHandler>(\r\n    () => (node) => (event) => {\r\n      setExpanded(\r\n        expanded.includes(node.id)\r\n          ? expanded.filter((id) => id !== node.id)\r\n          : [...expanded, node.id]\r\n      );\r\n    },\r\n    [expanded, setExpanded]\r\n  );\r\n\r\n  return (\r\n    <React.Fragment>\r\n      <TreeView\r\n        className={classes.root}\r\n        expanded={expanded}\r\n        defaultCollapseIcon={<ExpandMoreIcon />}\r\n        defaultExpandIcon={<ChevronRightIcon />}\r\n        defaultEndIcon={<RemoveIcon />}\r\n      >\r\n        {nodes.map(render(toggleExpand))}\r\n      </TreeView>\r\n    </React.Fragment>\r\n  );\r\n};\r\n","import * as React from \"react\";\r\nimport { Paper, Typography } from \"@material-ui/core\";\r\n\r\nimport { MareLineTree } from \"./MareLineTree\";\r\n\r\nexport const MareLine: React.FC = () => {\r\n  return (\r\n    <React.Fragment>\r\n      <Typography variant=\"h4\">牝系図</Typography>\r\n      <Paper>\r\n        <MareLineTree />\r\n      </Paper>\r\n    </React.Fragment>\r\n  );\r\n};\r\n","import React, { useEffect, useMemo, useState } from \"react\";\r\nimport { Redirect, Route, Switch } from \"react-router\";\r\nimport { BrowserRouter } from \"react-router-dom\";\r\nimport { Family } from \"./features/family/Family\";\r\nimport { Http404 } from \"./features/errors/404\";\r\nimport {\r\n  AppBar,\r\n  Box,\r\n  Drawer,\r\n  IconButton,\r\n  Link as Anchor,\r\n  List,\r\n  // ListItem,\r\n  Toolbar,\r\n  Typography,\r\n  useTheme,\r\n} from \"@material-ui/core\";\r\nimport { Link } from \"react-router-dom\";\r\nimport { MenuOutlined } from \"@material-ui/icons\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport { horseDefsActions } from \"./features/horse-defs\";\r\nimport { MareLine } from \"./features/mare-line\";\r\nimport { Indicator } from \"./features/indicator\";\r\n\r\nimport \"./App.css\";\r\n\r\ntype MenuItemDef = {\r\n  label: string;\r\n  path: string;\r\n};\r\n\r\nconst renderListItem = (def: MenuItemDef) => {\r\n  return (\r\n    <Typography>\r\n      <Link to={def.path}>{def.label}</Link>\r\n    </Typography>\r\n  );\r\n  // return <ListItem key={def.path}>{def}</ListItem>;\r\n};\r\n\r\nconst MenuList: React.FC<{\r\n  toggleMenu: () => void;\r\n}> = ({ toggleMenu }) => {\r\n  const defs = [\r\n    {\r\n      label: \"牝系図\",\r\n      path: \"/mare-line\",\r\n    },\r\n    {\r\n      label: \"家系図(旧)\",\r\n      path: \"/family\",\r\n    },\r\n  ];\r\n\r\n  return (\r\n    <List onClick={toggleMenu} onKeyDown={toggleMenu}>\r\n      {defs.map(renderListItem)}\r\n    </List>\r\n  );\r\n};\r\n\r\nconst Header: React.FC = () => {\r\n  const [menuOpen, setMenuOpen] = useState<boolean>(false);\r\n\r\n  const toggleMenu = useMemo(\r\n    () => () => {\r\n      setMenuOpen(!menuOpen);\r\n    },\r\n    [menuOpen, setMenuOpen]\r\n  );\r\n\r\n  return (\r\n    <React.Fragment>\r\n      <AppBar position=\"static\">\r\n        <Toolbar>\r\n          <IconButton\r\n            edge=\"start\"\r\n            color=\"inherit\"\r\n            aria-label=\"menu\"\r\n            onClick={toggleMenu}\r\n          >\r\n            <MenuOutlined />\r\n          </IconButton>\r\n          <Typography variant=\"h6\">MOTTV Derby</Typography>\r\n          {/* <Button color=\"inherit\">Login</Button> */}\r\n        </Toolbar>\r\n      </AppBar>\r\n      <Drawer open={menuOpen} onClose={toggleMenu}>\r\n        <MenuList toggleMenu={toggleMenu} />\r\n      </Drawer>\r\n    </React.Fragment>\r\n  );\r\n};\r\n\r\nconst Footer: React.FC = () => {\r\n  const theme = useTheme();\r\n  return (\r\n    <Box display=\"flex\" justifyContent=\"flex-end\" margin={theme.spacing(0.2)}>\r\n      <Anchor href=\"https://www.youtube.com/user/MOTTYGAMES/\" target=\"__blank\">\r\n        MOTTV\r\n      </Anchor>\r\n    </Box>\r\n  );\r\n};\r\n\r\nexport const App: React.FC = () => {\r\n  const theme = useTheme();\r\n  const dispatch = useDispatch();\r\n\r\n  useEffect(() => {\r\n    dispatch(horseDefsActions.init());\r\n  }, [dispatch]);\r\n\r\n  return (\r\n    <BrowserRouter basename={process.env.PUBLIC_URL}>\r\n      <React.Fragment>\r\n        <Header />\r\n        <Box margin={theme.spacing(0.5)}>\r\n          <Switch>\r\n            <Route path=\"/family\">\r\n              <Family />\r\n            </Route>\r\n            <Route path=\"/mare-line\">\r\n              <MareLine />\r\n            </Route>\r\n            <Route exact path=\"/\">\r\n              <Redirect to=\"/mare-line\" />\r\n            </Route>\r\n            <Route>\r\n              <Http404 />\r\n            </Route>\r\n          </Switch>\r\n        </Box>\r\n        <Footer />\r\n        <Indicator />\r\n      </React.Fragment>\r\n    </BrowserRouter>\r\n  );\r\n};\r\n","import { configureStore } from \"@reduxjs/toolkit\";\r\nimport { Action } from \"redux\";\r\nimport { combineEpics, createEpicMiddleware } from \"redux-observable\";\r\n\r\nimport { horseDefsReducer, horseDefsEpic } from \"../features/horse-defs\";\r\nimport { indicatorReducer } from \"../features/indicator\";\r\n\r\nconst dependencies = {};\r\nconst epicMiddleware = createEpicMiddleware<\r\n  Action,\r\n  Action,\r\n  void,\r\n  typeof dependencies\r\n>({\r\n  dependencies,\r\n});\r\n\r\nexport const store = configureStore({\r\n  reducer: {\r\n    horseDefs: horseDefsReducer,\r\n    indicator: indicatorReducer,\r\n  },\r\n  middleware: (getDefaultMiddleware) =>\r\n    getDefaultMiddleware({\r\n      thunk: false,\r\n    }).concat([epicMiddleware]),\r\n});\r\n\r\nepicMiddleware.run(combineEpics(horseDefsEpic) as any);\r\n\r\nexport type RootState = ReturnType<typeof store.getState>;\r\nexport type Dependencies = typeof dependencies;\r\n","// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read https://bit.ly/CRA-PWA\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.0/8 are considered localhost for IPv4.\r\n    window.location.hostname.match(\r\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n    )\r\n);\r\n\r\ntype Config = {\r\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\r\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\r\n};\r\n\r\nexport function register(config?: Config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl: string, config?: Config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then(registration => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker == null) {\r\n          return;\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\r\n              );\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch(error => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl, {\r\n    headers: { 'Service-Worker': 'script' },\r\n  })\r\n    .then(response => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get('content-type');\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf('javascript') === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then(registration => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        'No internet connection found. App is running in offline mode.'\r\n      );\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready\r\n      .then(registration => {\r\n        registration.unregister();\r\n      })\r\n      .catch(error => {\r\n        console.error(error.message);\r\n      });\r\n  }\r\n}\r\n","import { createMuiTheme, MuiThemeProvider } from '@material-ui/core';\r\nimport React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './index.css';\r\nimport { App } from './App';\r\nimport { store } from './app/store';\r\nimport { Provider } from 'react-redux';\r\nimport * as serviceWorker from './serviceWorker';\r\n\r\nconst theme = createMuiTheme({});\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <MuiThemeProvider theme={theme}>\r\n      <Provider store={store}>\r\n        <App />\r\n      </Provider>\r\n    </MuiThemeProvider>\r\n  </React.StrictMode>,\r\n  document.getElementById('root')\r\n);\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: https://bit.ly/CRA-PWA\r\nserviceWorker.unregister();\r\n"],"sourceRoot":""}