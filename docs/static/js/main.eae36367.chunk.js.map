{"version":3,"sources":["features/family/components/FamilyDiagram.tsx","features/family/Family.tsx","features/errors/404.tsx","features/horse-defs/core/ducks.ts","features/indicator/core/ducks.ts","features/indicator/core/util.ts","features/indicator/components/Indicator.tsx","features/horse-defs/core/horse.ts","features/horse-defs/core/epic.ts","features/pedigree/core/ducks.ts","features/pedigree/component/PedigreeTable.tsx","features/pedigree/component/PedigreeDialog.tsx","features/mare-line/components/MareLineTree.tsx","features/mare-line/components/MareLine.tsx","features/changelog/components/ChangeLog.tsx","features/changelog/core/ducks.ts","features/changelog/core/epic.ts","features/changelog/core/logic.ts","App.tsx","app/store.ts","serviceWorker.ts","index.tsx"],"names":["FamilyDiagram","d3Container","useRef","defs","useSelector","state","horseDefs","list","data","useMemo","nodes","Map","edges","forEach","def","owned","listed","set","name","label","class","sex","motherName","has","push","v","w","fatherName","Array","from","entries","prepareGraph","useEffect","svg","d3","current","selectAll","remove","length","g","dagreD3","Graph","setGraph","rankdir","setDefaultEdgeLabel","n","setNode","node","rx","ry","e","setEdge","render","svgGroup","append","zoom","on","attr","transform","call","xCenterOffset","Number","graph","width","isNaN","className","height","ref","Family","Box","Typography","variant","Paper","Http404","horseDefsSlice","createSlice","initialState","reducers","init","draft","action","payload","actions","reducer","slice","awaits","open","key","close","target","rest","console","warn","indicatorActions","withIndicator","input","action$","pipe","mergeMap","concat","of","defer","useStyles","makeStyles","theme","backdrop","zIndex","drawer","color","Indicator","classes","indicator","waiting","Object","values","some","x","Backdrop","CircularProgress","lineMap","Uk","Ec","Ph","Ns","Ro","Ne","Na","Fa","To","Te","Sw","Ha","Hi","St","Ma","He","flatten","childName","show","fathers","father","mothers","mother","line","memo","flat","fetchOwned","fetch","process","then","res","json","filter","removed","map","fetchBroodmare","fetchStallion","epic","combineEpics","ofType","horseDefsActions","type","a","func","mergeAll","groupBy","group","reduce","lhs","rhs","toArray","tap","m","complementLine","get","toPromise","displays","pop","_","clear","createStyles","table","backgroundColor","palette","primary","contrastText","cols","row","TableRow","ix","cell","col","threshold","limit","flatMap","join","TableCell","rowSpan","renderCell","PedigreeTable","array","generation","mapPedigree","construct","TableContainer","component","Table","size","TableBody","PedigreeDialog","dispatch","useDispatch","pedigree","find","handleClose","pedigreeActions","Dialog","onClose","DialogTitle","style","paddingLeft","root","marginLeft","spacing","InformationIcon","handleClick","IconButton","aria-label","onClick","fontSize","fetchOrCreateNode","id","created","children","icon","faMars","faVenus","faQuestion","setNodeProperty","value","ids","keys","toggleExpand","TreeItem","nodeId","onIconClick","MareLineTree","useState","expanded","setExpanded","withIndicatorSync","event","includes","TreeView","defaultCollapseIcon","defaultExpandIcon","defaultEndIcon","paper","padding","MareLine","ChangeLog","article","changeLog","changeLogActions","source","text","renderListItem","ListItem","button","Link","to","path","ListItemIcon","ListItemText","page","Timeline","ChangeHistory","MenuList","toggleMenu","List","onKeyDown","Header","menuOpen","setMenuOpen","Fragment","AppBar","position","Toolbar","edge","MenuOutlined","Drawer","Footer","useTheme","display","justifyContent","margin","href","App","basename","exact","epicMiddleware","createEpicMiddleware","dependencies","store","configureStore","horseDefsReducer","indicatorReducer","pedigreeReducer","changeLogReducer","middleware","getDefaultMiddleware","thunk","run","horseDefsEpic","changeLogEpic","Boolean","window","location","hostname","match","createMuiTheme","ReactDOM","StrictMode","document","getElementById","navigator","serviceWorker","ready","registration","unregister","catch","error","message"],"mappings":"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","file":"static/js/main.eae36367.chunk.js","sourcesContent":["import * as React from \"react\";\r\nimport { useEffect, useMemo, useRef } from \"react\";\r\nimport * as d3 from \"d3\";\r\nimport * as dagreD3 from \"dagre-d3\";\r\nimport * as graphlib from \"graphlib\";\r\n\r\nimport { HorseDef } from \"../../horse-defs\";\r\n\r\nimport \"./FamilyDiagram.css\";\r\nimport { Edge } from \"dagre-d3\";\r\nimport { useSelector } from \"react-redux\";\r\nimport { RootState } from \"../../../app/store\";\r\n\r\nconst prepareGraph = (defs: HorseDef[]) => {\r\n  const nodes = new Map<string, dagreD3.Label>();\r\n  const edges: [Edge, dagreD3.Label][] = [];\r\n\r\n  defs.forEach((def) => {\r\n    if (!def.owned && !def.listed) {\r\n      return;\r\n    }\r\n    // 定義された馬本体\r\n    nodes.set(def.name, {\r\n      label: def.name,\r\n      class: `owned ${def.sex}`,\r\n    });\r\n\r\n    // 母親\r\n    if (def.motherName) {\r\n      // 未登録なら非所持馬として追加\r\n      if (!nodes.has(def.motherName)) {\r\n        nodes.set(def.motherName, {\r\n          label: def.motherName,\r\n          class: \"anothers female\",\r\n        });\r\n      } else {\r\n        // TODO: 所持馬扱いに書き換える\r\n      }\r\n      edges.push([{ v: def.motherName, w: def.name }, { class: \"mother\" }]);\r\n    }\r\n\r\n    if (def.fatherName) {\r\n      if (!nodes.has(def.fatherName)) {\r\n        nodes.set(def.fatherName, {\r\n          label: def.fatherName,\r\n          class: \"anothers male\",\r\n        });\r\n      } else {\r\n        // TODO: 所持馬扱いに書き換える\r\n      }\r\n      edges.push([{ v: def.fatherName, w: def.name }, { class: \"father\" }]);\r\n    }\r\n  });\r\n\r\n  return { nodes: Array.from(nodes.entries()), edges };\r\n};\r\n\r\nexport const FamilyDiagram: React.FC = () => {\r\n  const d3Container = useRef<SVGSVGElement>(null!);\r\n\r\n  const defs = useSelector((state: RootState) => state.horseDefs.list);\r\n  const data = useMemo(() => prepareGraph(defs), [defs]);\r\n\r\n  useEffect(() => {\r\n    const svg = d3.select<SVGSVGElement, SVGSVGElement>(d3Container.current);\r\n    svg.selectAll(\"g\").remove();\r\n\r\n    if (data.nodes.length === 0 && data.edges.length === 0) {\r\n      return;\r\n    }\r\n\r\n    const g = new dagreD3.graphlib.Graph()\r\n      .setGraph({\r\n        rankdir: \"LR\",\r\n      })\r\n      .setDefaultEdgeLabel(() => ({}));\r\n\r\n    // Here we're setting nodeclass, which is used by our custom drawNodes function\r\n    // below.\r\n    data.nodes.forEach((n) => {\r\n      g.setNode(n[0], n[1]);\r\n    });\r\n\r\n    g.nodes().forEach(function (v) {\r\n      var node = g.node(v);\r\n      // Round the corners of the nodes\r\n      node.rx = node.ry = 5;\r\n    });\r\n\r\n    // Set up edges, no special attributes.\r\n    data.edges.forEach((e) => {\r\n      g.setEdge(e[0], e[1]);\r\n    });\r\n\r\n    // Create the renderer\r\n    var render = new dagreD3.render();\r\n    const svgGroup = svg.append(\"g\");\r\n\r\n    // Set up zoom support\r\n    const zoom = d3.zoom<SVGSVGElement, SVGSVGElement>().on(\"zoom\", () => {\r\n      svgGroup.attr(\"transform\", d3.event.transform);\r\n    });\r\n    svg.call(zoom);\r\n\r\n    // Run the renderer. This is what draws the final graph.\r\n    render(d3.select(\"svg g\"), (g as unknown) as graphlib.Graph);\r\n\r\n    // Center the graph\r\n    const xCenterOffset =\r\n      (Number(svg.attr(\"width\")) - (g.graph().width || 0)) / 2;\r\n    svgGroup.attr(\r\n      \"transform\",\r\n      `translate(${Number.isNaN(xCenterOffset) ? 0 : xCenterOffset}, 20)`\r\n    );\r\n    // svg.attr(\"height\", (g.graph().height || 0) + 40);\r\n  }, [d3Container, data]);\r\n\r\n  return (\r\n    <React.Fragment>\r\n      <svg\r\n        className=\"d3-component mottv-derby-family\"\r\n        width=\"100%\"\r\n        height=\"70vh\"\r\n        ref={d3Container}\r\n      />\r\n    </React.Fragment>\r\n  );\r\n};\r\n","import { Box, Paper, Typography } from \"@material-ui/core\";\r\nimport * as React from \"react\";\r\nimport { FamilyDiagram } from \"./components/FamilyDiagram\";\r\n\r\nexport const Family: React.FC = () => {\r\n  return (\r\n    <Box>\r\n      <Typography variant=\"h4\">系図</Typography>\r\n      <Paper>\r\n        <FamilyDiagram />\r\n      </Paper>\r\n    </Box>\r\n  );\r\n};\r\n","import * as React from 'react';\r\n\r\nexport const Http404: React.FC = () => {\r\n    return <h2>404 NOT FOUND</h2>;\r\n}\r\n","import { createSlice, PayloadAction } from \"@reduxjs/toolkit\";\r\nimport { HorseDef } from \"./horse\";\r\n\r\nexport type HorseDefState = {\r\n  list: HorseDef[];\r\n};\r\n\r\nconst horseDefsSlice = createSlice({\r\n  name: \"horseDefs\",\r\n  initialState: { list: [] as HorseDef[] },\r\n  reducers: {\r\n    init: () => {},\r\n    set: (draft, action: PayloadAction<HorseDefState>) => {\r\n      draft.list = action.payload.list;\r\n    },\r\n  },\r\n});\r\n\r\nexport const { actions, reducer } = horseDefsSlice;\r\nexport type HorseDefsAction = ReturnType<typeof actions[keyof typeof actions]>;\r\n","import { createSlice, PayloadAction } from \"@reduxjs/toolkit\";\r\n\r\nexport type IndicatorState = {\r\n  awaits: { [key: string]: number };\r\n};\r\n\r\nconst slice = createSlice({\r\n  name: \"indicator\",\r\n  initialState: { awaits: {} } as IndicatorState,\r\n  reducers: {\r\n    set: (draft, action: PayloadAction<IndicatorState[\"awaits\"]>) => {\r\n      draft.awaits = action.payload;\r\n    },\r\n    open: (draft, { payload: key }: PayloadAction<string>) => {\r\n      draft.awaits = {\r\n        ...draft.awaits,\r\n        [key]: 1 + (key in draft.awaits ? draft.awaits[key] : 0),\r\n      };\r\n    },\r\n    close: (draft, { payload: key }: PayloadAction<string>) => {\r\n      if (!(key in draft.awaits)) {\r\n        console.warn(`there isnt key [${key}] in `);\r\n        return;\r\n      }\r\n      const { [key]: target, ...rest } = draft.awaits;\r\n      draft.awaits = {\r\n        ...rest,\r\n        ...(target > 1 ? { [key]: target - 1 } : {}),\r\n      };\r\n    },\r\n  },\r\n});\r\n\r\nexport const { actions, reducer } = slice;\r\nexport type IndicatorAction = ReturnType<typeof actions[keyof typeof actions]>;\r\n","import {\r\n  OperatorFunction,\r\n  ObservableInput,\r\n  ObservedValueOf,\r\n  of,\r\n  defer,\r\n  concat,\r\n} from \"rxjs\";\r\nimport { mergeMap } from \"rxjs/operators\";\r\nimport { Dispatch } from \"react\";\r\nimport { Action } from \"redux\";\r\nimport { indicatorActions, IndicatorAction } from \"..\";\r\n\r\nconst { open, close } = indicatorActions;\r\n// export const withIndicator = <T extends Action>(\r\n//   label: string\r\n// ): OperatorFunction<T, T | IndicatorAction> => (action$) =>\r\n//   action$.pipe(startWith(open(label)), endWith(close(label)));\r\nexport const withIndicator = <\r\n  T extends Action,\r\n  O extends ObservableInput<Action>\r\n>(\r\n  label: string,\r\n  input: (action: T) => O\r\n): OperatorFunction<T, ObservedValueOf<O> | IndicatorAction> => (action$) =>\r\n  action$.pipe(\r\n    mergeMap((action) =>\r\n      concat(\r\n        of(open(label)),\r\n        defer(() => input(action)),\r\n        of(close(label))\r\n      )\r\n    )\r\n  );\r\n//   action$.pipe(\r\n//     mergeMap((action) =>\r\n//       concat(\r\n//         of(open(label)),\r\n//         defer(() => input(action)),\r\n//         of(endWith(close(label)))\r\n//       )\r\n//     )\r\n//   );\r\n\r\nexport const withIndicatorSync = (dispatch: Dispatch<any>) => (\r\n  label: string\r\n) => <R>(func: () => R) => {\r\n  try {\r\n    dispatch(open(label));\r\n    return func();\r\n  } finally {\r\n    dispatch(close(label));\r\n  }\r\n};\r\n\r\nexport const withIndicatorAsync = (dispatch: Dispatch<any>) => (\r\n  label: string\r\n) => <R>(func: () => PromiseLike<R>) => {\r\n  return new Promise(() => {\r\n    dispatch(open(label));\r\n  })\r\n    .then(func)\r\n    .finally(() => {\r\n      dispatch(close(label));\r\n    });\r\n};\r\n","import { Backdrop, CircularProgress, makeStyles } from \"@material-ui/core\";\r\nimport React, { useMemo } from \"react\";\r\nimport { useSelector } from \"react-redux\";\r\nimport { RootState } from \"../../../app/store\";\r\n\r\nconst useStyles = makeStyles((theme) => ({\r\n  backdrop: {\r\n    zIndex: theme.zIndex.drawer + 1,\r\n    color: \"#fff\",\r\n  },\r\n}));\r\n\r\nexport const Indicator: React.FC = () => {\r\n  const classes = useStyles();\r\n  const { awaits } = useSelector((state: RootState) => state.indicator);\r\n\r\n  const waiting = useMemo(() => Object.values(awaits).some((x) => x > 0), [\r\n    awaits,\r\n  ]);\r\n\r\n  return (\r\n    <Backdrop className={classes.backdrop} open={waiting}>\r\n      <CircularProgress color=\"inherit\" />\r\n    </Backdrop>\r\n  );\r\n};\r\n","import { of } from \"rxjs\";\r\nimport {\r\n  groupBy,\r\n  mergeAll,\r\n  mergeMap,\r\n  toArray,\r\n  reduce,\r\n  tap,\r\n} from \"rxjs/operators\";\r\n\r\nexport type Sex = \"male\" | \"female\" | \"unknown\";\r\n\r\nexport type Line =\r\n  | \"Uk\" // 不明(指定なし)\r\n  | \"Ec\" // エクリプス系\r\n  | \"Ph\" // ファラリス系\r\n  | \"Ns\" // ナスルーラ系\r\n  | \"Ro\" // ロイヤルチャージャー系\r\n  | \"Ne\" // ニアークティック系\r\n  | \"Na\" // ネイティヴダンサー系\r\n  | \"Fa\" // フェアウェイ系\r\n  | \"To\" // トムフール系\r\n  | \"Te\" // テディ系\r\n  | \"Sw\" // スインフォード系\r\n  | \"Ha\" // ハンプトン系\r\n  | \"Hi\" // ヒムヤー系\r\n  | \"St\" // セントサイモン系\r\n  | \"Ma\" // マッチェム系\r\n  | \"He\"; // ヘロド系\r\n\r\nexport const lineMap: { [key in Line]: { label: string } } = {\r\n  Uk: { label: \"不明(指定なし)\" },\r\n  Ec: { label: \"エクリプス\" },\r\n  Ph: { label: \"ファラリス\" },\r\n  Ns: { label: \"ナスルーラ\" },\r\n  Ro: { label: \"ロイヤルチャージャー\" },\r\n  Ne: { label: \"ニアークティック\" },\r\n  Na: { label: \"ネイティヴダンサー\" },\r\n  Fa: { label: \"フェアウェイ\" },\r\n  To: { label: \"トムフール\" },\r\n  Te: { label: \"テディ\" },\r\n  Sw: { label: \"スインフォード\" },\r\n  Ha: { label: \"ハンプトン\" },\r\n  Hi: { label: \"ヒムヤー\" },\r\n  St: { label: \"セントサイモン\" },\r\n  Ma: { label: \"マッチェム\" },\r\n  He: { label: \"ヘロド\" },\r\n};\r\n\r\nexport type HorseDef = {\r\n  /** 名称: ID代わり */\r\n  name: string;\r\n  /** 父親名 */\r\n  fatherName?: string;\r\n  /** 母親名 */\r\n  motherName?: string;\r\n  /** 性別 */\r\n  sex: Sex;\r\n  /** 系統 */\r\n  line: Line;\r\n  /** 種牡馬/繁殖牝馬一覧に載っているか */\r\n  listed: boolean;\r\n  /** 所有馬 */\r\n  owned: boolean;\r\n  /** 表示すべきか */\r\n  show: boolean;\r\n  /** メモ */\r\n  memo: string[];\r\n};\r\n\r\ntype AnscestorHorse = {\r\n  name?: string;\r\n  father?: AnscestorHorse;\r\n  mother?: AnscestorHorse;\r\n  line?: Line;\r\n};\r\ninterface ListedAnscestor extends AnscestorHorse {\r\n  name: Exclude<AnscestorHorse[\"name\"], undefined>;\r\n  father: Exclude<AnscestorHorse[\"father\"], undefined>;\r\n  mother: Exclude<AnscestorHorse[\"mother\"], undefined>;\r\n}\r\n\r\n/**\r\n * 種牡馬・繁殖牝馬リストを競走馬一覧にflattenして返す\r\n * @param def\r\n * @param param1\r\n */\r\nconst flatten = (\r\n  def: AnscestorHorse,\r\n  { sex, listed, childName }: { sex: Sex; listed?: boolean; childName: string }\r\n): HorseDef[] => {\r\n  const name =\r\n    def.name ??\r\n    `${childName}${sex === \"female\" ? \"母\" : sex === \"male\" ? \"父\" : \"親\"}`;\r\n  const show = def.name !== void 0;\r\n\r\n  const fathers = def.father\r\n    ? flatten(def.father, { sex: \"male\", childName: name })\r\n    : [];\r\n  const mothers = def.mother\r\n    ? flatten(def.mother, { sex: \"female\", childName: name })\r\n    : [];\r\n  const line = def.line ?? fathers?.[0]?.line ?? \"Uk\";\r\n\r\n  const target: HorseDef = {\r\n    name,\r\n    line,\r\n    listed: !!listed,\r\n    owned: false,\r\n    show,\r\n    fatherName: fathers?.[0]?.name,\r\n    motherName: mothers?.[0]?.name,\r\n    memo: [],\r\n    sex,\r\n  };\r\n\r\n  return [target, fathers, mothers].flat();\r\n};\r\n\r\nconst fetchOwned =\r\n  // 所有馬\r\n  (): Promise<HorseDef[]> =>\r\n    fetch(`${process.env.PUBLIC_URL}/assets/horse-defs.json`)\r\n      .then((res) => res.json())\r\n      .then((data: (HorseDef & { removed?: boolean })[]) =>\r\n        data\r\n          .filter((def) => !def.removed)\r\n          .map((def) => ({\r\n            ...def,\r\n            listed: !!def.listed,\r\n            owned: true,\r\n            show: true,\r\n            memo: def.memo ?? [],\r\n          }))\r\n      );\r\n\r\n/**\r\n * 繁殖牝馬リスト\r\n */\r\nconst fetchBroodmare = (): Promise<HorseDef[]> =>\r\n  fetch(`${process.env.PUBLIC_URL}/assets/broodmares.json`)\r\n    .then((res) => res.json())\r\n    .then((data: ListedAnscestor[]) =>\r\n      data\r\n        .map((def) =>\r\n          flatten(def, { sex: \"female\", listed: true, childName: \"N/A\" })\r\n        )\r\n        .flat()\r\n    );\r\n\r\n/**\r\n * 種牡馬リスト\r\n */\r\nconst fetchStallion = (): Promise<HorseDef[]> =>\r\n  fetch(`${process.env.PUBLIC_URL}/assets/stallions.json`)\r\n    .then((res) => res.json())\r\n    .then((data: ListedAnscestor[]) =>\r\n      data\r\n        .map((def) =>\r\n          flatten(def, { sex: \"male\", listed: true, childName: \"N/A\" })\r\n        )\r\n        .flat()\r\n    );\r\n\r\n/**\r\n * 競走馬の定義を取得してマージする\r\n */\r\nexport const fetchHorseDefs = (): Promise<HorseDef[]> =>\r\n  of(fetchOwned, fetchStallion, fetchBroodmare)\r\n    .pipe(\r\n      mergeMap((func) => func()),\r\n      mergeAll(),\r\n      groupBy((def) => def.name),\r\n      mergeMap((group) =>\r\n        group.pipe(\r\n          reduce((lhs, rhs) => ({\r\n            name: lhs.name ?? rhs.name,\r\n            sex: lhs.sex ?? rhs.sex,\r\n            listed: lhs.listed || rhs.listed,\r\n            show: lhs.show || rhs.show,\r\n            owned: lhs.owned || rhs.owned,\r\n            line: lhs.line === \"Uk\" ? rhs.line : lhs.line,\r\n            memo: [...lhs.memo, ...rhs.memo],\r\n            fatherName: lhs.fatherName ?? rhs.fatherName,\r\n            motherName: lhs.motherName ?? rhs.motherName,\r\n          }))\r\n        )\r\n      ),\r\n      toArray(),\r\n      tap((defs) => {\r\n        const m = new Map<string, HorseDef>(defs.map((def) => [def.name, def]));\r\n\r\n        /** lineがUnknownのものを父親の情報から保完する */\r\n        const complementLine = (def: HorseDef) => {\r\n          // 対応不要\r\n          if (def.line && def.line !== \"Uk\") {\r\n            return;\r\n          }\r\n\r\n          // 父親が後ろにいるかも知れないので先に再帰しておく\r\n          if (def.fatherName) {\r\n            if (m.has(def.fatherName)) {\r\n              complementLine(m.get(def.fatherName)!);\r\n            } else {\r\n              console.warn(\r\n                `${def.fatherName}: father of ${def.name} doesnt exist in list`,\r\n                def,\r\n                m\r\n              );\r\n            }\r\n          }\r\n\r\n          // それでも未確定ならUkに設定\r\n          def.line = m.get(def.fatherName!)?.line ?? \"Uk\";\r\n\r\n          if (def.line === \"Uk\") {\r\n            console.warn(`couldnt determine line of ${def.name}`);\r\n          }\r\n        };\r\n        defs.forEach(complementLine);\r\n      })\r\n    )\r\n    .toPromise();\r\n","import { Epic, combineEpics } from \"redux-observable\";\r\n\r\nimport { horseDefsActions, HorseDefsAction } from \"..\";\r\nimport { withIndicator, IndicatorAction } from \"../../indicator\";\r\nimport { fetchHorseDefs } from \"./horse\";\r\n\r\nexport const fetchDefsEpic: Epic<\r\n  HorseDefsAction | IndicatorAction,\r\n  HorseDefsAction | IndicatorAction\r\n> = (action$) =>\r\n  action$\r\n    .ofType(horseDefsActions.init.type)\r\n    .pipe(\r\n      withIndicator(\"horse-defs/fetch\", async () =>\r\n        horseDefsActions.set({ list: await fetchHorseDefs() })\r\n      )\r\n    );\r\n\r\nexport const epic = combineEpics(fetchDefsEpic);\r\n","import { createSlice, PayloadAction } from \"@reduxjs/toolkit\";\r\n\r\nexport type PedigreeState = {\r\n  displays: string[];\r\n};\r\n\r\nconst slice = createSlice({\r\n  name: \"pedigree\",\r\n  initialState: { displays: [] } as PedigreeState,\r\n  reducers: {\r\n    set: (draft, action: PayloadAction<PedigreeState[\"displays\"]>) => {\r\n      draft.displays = action.payload;\r\n    },\r\n    push: (draft, { payload: key }: PayloadAction<string>) => {\r\n      draft.displays.push(key);\r\n    },\r\n    pop: (draft, _: PayloadAction<void>) => {\r\n      if (draft.displays.length <= 0) {\r\n        console.warn(`pedigree list is empty`);\r\n        return;\r\n      }\r\n      draft.displays.pop();\r\n    },\r\n    clear: (draft, _: PayloadAction<void>) => {\r\n      draft.displays = [];\r\n    },\r\n  },\r\n});\r\n\r\nexport const { actions, reducer } = slice;\r\nexport type PedigreeAction = ReturnType<typeof actions[keyof typeof actions]>;\r\n","import { makeStyles, createStyles, Theme, Typography } from \"@material-ui/core\";\r\nimport {\r\n  TableContainer,\r\n  Table,\r\n  TableBody,\r\n  TableRow,\r\n  TableCell,\r\n  Paper,\r\n} from \"@material-ui/core\";\r\nimport * as React from \"react\";\r\nimport { useMemo } from \"react\";\r\nimport { useSelector } from \"react-redux\";\r\n\r\nimport { RootState } from \"../../../app/store\";\r\n\r\nimport { HorseDef } from \"../../horse-defs\";\r\nimport { Line, lineMap } from \"../../horse-defs\";\r\n\r\nexport interface PedigreeTableProps {\r\n  def: HorseDef;\r\n}\r\n\r\ntype PedigreeNode = {\r\n  name: string;\r\n  generation: number;\r\n  show: boolean;\r\n  line: Line;\r\n};\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n  createStyles({\r\n    table: {\r\n      \"& .cell\": {\r\n        backgroundColor: \"gray\",\r\n        \"&.empty\": {\r\n          backgroundColor: \"lightgray\",\r\n        },\r\n        \"&.Ec\": {\r\n          backgroundColor: \"#ffffff\",\r\n        },\r\n        \"&.Ph\": {\r\n          backgroundColor: \"#cfe8ff\",\r\n        },\r\n        \"&.Ns\": {\r\n          backgroundColor: \"#00bb00\",\r\n        },\r\n        \"&.Ro\": {\r\n          backgroundColor: \"#ffb4c8\",\r\n        },\r\n        \"&.Ne\": {\r\n          backgroundColor: \"#fdf488\",\r\n        },\r\n        \"&.Na\": {\r\n          backgroundColor: \"#52d8fd\",\r\n        },\r\n        \"&.Fa\": {\r\n          backgroundColor: \"#ffc943\",\r\n        },\r\n        \"&.To\": {\r\n          backgroundColor: \"#ff9d4b\",\r\n        },\r\n        \"&.Te\": {\r\n          color: theme.palette.primary.contrastText,\r\n          backgroundColor: \"#9e57ff\",\r\n        },\r\n        \"&.Sw\": {\r\n          backgroundColor: \"#ffe0e1\",\r\n        },\r\n        \"&.Ha\": {\r\n          backgroundColor: \"#90ee71\",\r\n        },\r\n        \"&.Hi\": {\r\n          color: theme.palette.primary.contrastText,\r\n          backgroundColor: \"#2c6aff\",\r\n        },\r\n        \"&.St\": {\r\n          backgroundColor: \"#9e93ff\",\r\n        },\r\n        \"&.Ma\": {\r\n          backgroundColor: \"#c5b2fe\",\r\n        },\r\n        \"&.He\": {\r\n          backgroundColor: \"#b9f8ff\",\r\n        },\r\n        \"&.mother\": {\r\n          color: theme.palette.primary.contrastText,\r\n          backgroundColor: \"#dd7165\",\r\n        },\r\n      },\r\n    },\r\n  })\r\n);\r\n\r\n/** 対象世代の限界点 */\r\nconst limit = 5;\r\nconst construct = (map: Map<string, HorseDef>) => (\r\n  def: HorseDef\r\n): PedigreeNode[][] => {\r\n  const table = new Array<PedigreeNode[]>();\r\n\r\n  for (let row = 0; row < 2 ** (limit - 1); ++row) {\r\n    const cols = new Array<PedigreeNode>();\r\n    for (let col = 0; col < limit; ++col) {\r\n      cols.push({ name: \"empty\", generation: col, show: false, line: \"Uk\" });\r\n    }\r\n    table.push(cols);\r\n  }\r\n\r\n  const mapPedigree = (row: number, col: number, def: HorseDef) => {\r\n    table[row][col] = {\r\n      name: def.name,\r\n      generation: col,\r\n      show: !!def.show,\r\n      line: def.line,\r\n    };\r\n\r\n    if (col + 1 < limit) {\r\n      if (def.fatherName) {\r\n        if (map.has(def.fatherName)) {\r\n          mapPedigree(row, col + 1, map.get(def.fatherName)!);\r\n        } else {\r\n          mapPedigree(row, col + 1, {\r\n            name: def.fatherName,\r\n            sex: \"male\",\r\n            line: \"Uk\",\r\n            listed: false,\r\n            show: true,\r\n            owned: false,\r\n            memo: [\"未定義\"],\r\n          });\r\n        }\r\n      }\r\n      if (def.motherName) {\r\n        if (map.has(def.motherName)) {\r\n          mapPedigree(\r\n            row + 2 ** (limit - col - 2),\r\n            col + 1,\r\n            map.get(def.motherName)!\r\n          );\r\n        } else {\r\n          mapPedigree(row + 2 ** (limit - col - 2), col + 1, {\r\n            name: def.motherName,\r\n            sex: \"female\",\r\n            line: \"Uk\",\r\n            listed: false,\r\n            show: true,\r\n            owned: false,\r\n            memo: [\"未定義\"],\r\n          });\r\n        }\r\n      }\r\n    }\r\n  };\r\n\r\n  mapPedigree(0, 0, def);\r\n  return table;\r\n};\r\n\r\nconst renderCell = (\r\n  row: number,\r\n  col: number,\r\n  cell: PedigreeNode\r\n): JSX.Element => {\r\n  const threshold = 2 ** (limit - col - 2);\r\n  const className = [\r\n    \"cell\",\r\n    !cell.show ? \"empty\" : cell.line,\r\n    col === 0 && row === 2 ** (limit - 2) ? [\"mother\"] : [],\r\n  ]\r\n    .flatMap((x) => x)\r\n    .join(\" \");\r\n  return (\r\n    <React.Fragment key={`col-${col}`}>\r\n      {row % threshold === 0 ? (\r\n        <TableCell rowSpan={threshold} className={className}>\r\n          {cell.show ? (\r\n            <Typography variant=\"body2\">{cell.name}</Typography>\r\n          ) : null}\r\n        </TableCell>\r\n      ) : null}\r\n    </React.Fragment>\r\n  );\r\n};\r\n\r\nconst renderLine = (line: Line): JSX.Element => {\r\n  return line !== \"Uk\" ? (\r\n    <TableCell\r\n      key={`col-line`}\r\n      className={[\"cell\", line].join(\" \")}\r\n      rowSpan={2}\r\n    >\r\n      <Typography variant=\"body2\">{lineMap[line].label}系</Typography>\r\n    </TableCell>\r\n  ) : (\r\n    <TableCell\r\n      key={`col-line`}\r\n      className={[\"cell\", \"empty\"].join(\" \")}\r\n      rowSpan={2}\r\n    />\r\n  );\r\n};\r\n\r\nconst render = (data: PedigreeNode[][]): JSX.Element => {\r\n  return (\r\n    <React.Fragment>\r\n      {data.map((cols, row) => (\r\n        <TableRow key={`row-${row}`}>\r\n          {cols\r\n            .filter((_, ix) => ix > 0)\r\n            .map((cell, col) => renderCell(row, col, cell))}\r\n          {row % 2 === 0 ? renderLine(cols[cols.length - 1].line) : null}\r\n        </TableRow>\r\n      ))}\r\n    </React.Fragment>\r\n  );\r\n};\r\n\r\nexport const PedigreeTable: React.FC<PedigreeTableProps> = ({ def }) => {\r\n  const classes = useStyles();\r\n  const defs = useSelector((state: RootState) => state.horseDefs.list);\r\n  const map = useMemo(\r\n    () =>\r\n      defs.reduce(\r\n        (map, def) => map.set(def.name, def),\r\n        new Map<string, typeof defs[number]>()\r\n      ),\r\n    [defs]\r\n  );\r\n\r\n  const array = construct(map)(def);\r\n\r\n  return (\r\n    <TableContainer component={Paper}>\r\n      <Table className={classes.table} size=\"small\">\r\n        <TableBody>{render(array)}</TableBody>\r\n      </Table>\r\n    </TableContainer>\r\n  );\r\n};\r\n","import * as React from \"react\";\r\nimport { useMemo } from \"react\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport { Dialog, DialogTitle, Typography } from \"@material-ui/core\";\r\n\r\nimport { RootState } from \"../../../app/store\";\r\n\r\nimport { pedigreeActions } from \"..\";\r\nimport { PedigreeTable } from \"./PedigreeTable\";\r\nimport { lineMap } from \"../../horse-defs\";\r\n\r\nexport const PedigreeDialog: React.FC = () => {\r\n  const dispatch = useDispatch();\r\n  const { displays } = useSelector((state: RootState) => state.pedigree);\r\n  const open = useMemo(() => displays.length > 0, [displays]);\r\n  const defs = useSelector((state: RootState) => state.horseDefs.list);\r\n  const def = useMemo(\r\n    () =>\r\n      displays.length > 0\r\n        ? defs.find((def) => def.name === displays[displays.length - 1])\r\n        : void 0,\r\n    [defs, displays]\r\n  );\r\n\r\n  const handleClose = useMemo(\r\n    () => () => {\r\n      dispatch(pedigreeActions.clear());\r\n    },\r\n    [dispatch]\r\n  );\r\n\r\n  return def ? (\r\n    <Dialog open={open} onClose={handleClose}>\r\n      <DialogTitle>\r\n        <Typography variant=\"h5\">血統表: {def.name}</Typography>\r\n        {def.line !== \"Uk\" ? (\r\n          <Typography variant=\"h6\" style={{ paddingLeft: \"1em\" }}>\r\n            大系統: {lineMap[def.line].label}系\r\n          </Typography>\r\n        ) : null}\r\n      </DialogTitle>\r\n      <PedigreeTable def={def} />\r\n    </Dialog>\r\n  ) : null;\r\n};\r\n","import { makeStyles, createStyles, Theme, IconButton } from \"@material-ui/core\";\r\nimport { TreeItem, TreeView } from \"@material-ui/lab\";\r\nimport ExpandMoreIcon from \"@material-ui/icons/ExpandMore\";\r\nimport ChevronRightIcon from \"@material-ui/icons/ChevronRight\";\r\nimport RemoveIcon from \"@material-ui/icons/Remove\";\r\nimport InfoOutlinedIcon from \"@material-ui/icons/InfoOutlined\";\r\nimport { FontAwesomeIcon } from \"@fortawesome/react-fontawesome\";\r\nimport { faMars, faQuestion, faVenus } from \"@fortawesome/free-solid-svg-icons\";\r\nimport * as React from \"react\";\r\nimport { useEffect, useMemo, useState } from \"react\";\r\nimport { useDispatch, useSelector } from \"react-redux\";\r\nimport { RootState } from \"../../../app/store\";\r\nimport { HorseDef } from \"../../horse-defs\";\r\nimport { withIndicatorSync } from \"../../indicator\";\r\nimport { pedigreeActions } from \"../../pedigree\";\r\n\r\ntype Datum = {\r\n  id: string;\r\n  label: JSX.Element;\r\n  className?: string;\r\n  children: Datum[];\r\n  fatherName?: string;\r\n  motherName?: string;\r\n  owned: boolean;\r\n};\r\n\r\nconst useStyles = makeStyles((theme: Theme) =>\r\n  createStyles({\r\n    root: {\r\n      \"& .name\": {\r\n        marginLeft: theme.spacing(0.5),\r\n      },\r\n      \"& .father\": {\r\n        marginLeft: theme.spacing(1),\r\n      },\r\n      \"& .male\": {\r\n        color: \"#2196f3\",\r\n      },\r\n      \"& .female\": {\r\n        color: \"#f44336\",\r\n      },\r\n      \"& .unknown\": {\r\n        color: \"#888888\",\r\n      },\r\n    },\r\n  })\r\n);\r\n\r\nconst InformationIcon: React.FC<{ name: string }> = ({ name }) => {\r\n  const dispatch = useDispatch();\r\n  const handleClick = useMemo(\r\n    () => () => {\r\n      dispatch(pedigreeActions.push(name));\r\n    },\r\n    [dispatch, name]\r\n  );\r\n\r\n  return (\r\n    <IconButton aria-label=\"horse info\" size=\"small\" onClick={handleClick}>\r\n      <InfoOutlinedIcon fontSize=\"inherit\" />\r\n    </IconButton>\r\n  );\r\n};\r\n\r\nconst setNodeProperty = (node: Datum, def: HorseDef) => {\r\n  node.owned = node.owned || def.owned;\r\n  node.className = [def.sex].join(\" \");\r\n  node.label = (\r\n    <React.Fragment>\r\n      {(() => {\r\n        switch (def.sex) {\r\n          case \"male\":\r\n            return <FontAwesomeIcon icon={faMars} />;\r\n          case \"female\":\r\n            return <FontAwesomeIcon icon={faVenus} />;\r\n          case \"unknown\":\r\n            return <FontAwesomeIcon icon={faQuestion} />;\r\n          default:\r\n            const __exhaust: never = def.sex; // eslint-disable-line @typescript-eslint/no-unused-vars\r\n        }\r\n      })()}\r\n      <span className=\"name\">\r\n        {def.name}\r\n        <InformationIcon name={def.name} />\r\n      </span>\r\n      {def.fatherName ? (\r\n        <React.Fragment>\r\n          (\r\n          <span className=\"father male\">\r\n            {def.fatherName}\r\n            <InformationIcon name={def.fatherName} />\r\n          </span>\r\n          )\r\n        </React.Fragment>\r\n      ) : null}\r\n    </React.Fragment>\r\n  );\r\n  node.fatherName = def.fatherName ?? node.fatherName;\r\n  node.motherName = def.motherName ?? node.fatherName;\r\n};\r\n\r\nconst construct = (defs: HorseDef[]): { nodes: Datum[]; ids: string[] } => {\r\n  const map = new Map<string, Datum>();\r\n\r\n  const fetchOrCreateNode = (id: string) =>\r\n    map.has(id)\r\n      ? (() => {\r\n          const fetched: Datum = map.get(id)!;\r\n          return fetched;\r\n        })()\r\n      : // 新規\r\n        (() => {\r\n          const created: Datum = {\r\n            id,\r\n            label: <React.Fragment />,\r\n            children: [],\r\n            owned: false,\r\n          };\r\n          map.set(id, created);\r\n          return created;\r\n        })();\r\n\r\n  const append = (def: HorseDef) => {\r\n    const node = fetchOrCreateNode(def.name);\r\n\r\n    setNodeProperty(node, def);\r\n\r\n    if (def.motherName) {\r\n      const mother = fetchOrCreateNode(def.motherName);\r\n      mother.children.push(node);\r\n    }\r\n  };\r\n\r\n  defs.forEach(append);\r\n  return {\r\n    nodes: Array.from(map.values()).filter(\r\n      (value) =>\r\n        // 所有場であることは絶対条件\r\n        value.owned &&\r\n        // 母の名前がわからないか\r\n        (!value.motherName ||\r\n          // 母が登録されていないか\r\n          !map.has(value.motherName) ||\r\n          // 母はいるけど所有場でないか\r\n          (map.has(value.motherName) && !map.get(value.motherName)?.owned))\r\n    ),\r\n    ids: Array.from(map.keys()),\r\n  };\r\n};\r\n\r\nconst render = (toggleExpand: (node: Datum) => React.MouseEventHandler) => (\r\n  node: Datum\r\n) => {\r\n  return (\r\n    <TreeItem\r\n      className={node.className}\r\n      key={node.id}\r\n      nodeId={node.id}\r\n      label={node.label}\r\n      onIconClick={toggleExpand(node)}\r\n    >\r\n      {node.children.map(render(toggleExpand))}\r\n    </TreeItem>\r\n  );\r\n};\r\n\r\nexport const MareLineTree: React.FC = () => {\r\n  const classes = useStyles();\r\n  const dispatch = useDispatch();\r\n  const [expanded, setExpanded] = useState<string[]>([]);\r\n\r\n  const defs = useSelector((state: RootState) => state.horseDefs.list);\r\n  const { nodes, ids } = useMemo(() => {\r\n    if (defs.length > 0) {\r\n      return withIndicatorSync(dispatch)(\"mare-line/init\")(() =>\r\n        construct(defs)\r\n      );\r\n    } else {\r\n      return { nodes: [], ids: [] };\r\n    }\r\n  }, [dispatch, defs]);\r\n\r\n  useEffect(() => {\r\n    setExpanded(ids);\r\n  }, [setExpanded, ids]);\r\n\r\n  const toggleExpand = useMemo<(node: Datum) => React.MouseEventHandler>(\r\n    () => (node) => (event) => {\r\n      setExpanded(\r\n        expanded.includes(node.id)\r\n          ? expanded.filter((id) => id !== node.id)\r\n          : [...expanded, node.id]\r\n      );\r\n    },\r\n    [expanded, setExpanded]\r\n  );\r\n\r\n  return (\r\n    <React.Fragment>\r\n      <TreeView\r\n        className={classes.root}\r\n        expanded={expanded}\r\n        defaultCollapseIcon={<ExpandMoreIcon />}\r\n        defaultExpandIcon={<ChevronRightIcon />}\r\n        defaultEndIcon={<RemoveIcon />}\r\n      >\r\n        {nodes.map(render(toggleExpand))}\r\n      </TreeView>\r\n    </React.Fragment>\r\n  );\r\n};\r\n","import * as React from \"react\";\r\nimport { createStyles, Paper, Typography, makeStyles } from \"@material-ui/core\";\r\n\r\nimport { MareLineTree } from \"./MareLineTree\";\r\n\r\nconst useStyles = makeStyles((theme) =>\r\n  createStyles({\r\n    paper: {\r\n      padding: theme.spacing(2),\r\n    },\r\n  })\r\n);\r\n\r\nexport const MareLine: React.FC = () => {\r\n  const classes = useStyles();\r\n  return (\r\n    <React.Fragment>\r\n      <Typography variant=\"h4\">牝系図</Typography>\r\n      <Paper className={classes.paper}>\r\n        <MareLineTree />\r\n      </Paper>\r\n    </React.Fragment>\r\n  );\r\n};\r\n","import { Paper, createStyles, makeStyles } from \"@material-ui/core\";\r\n\r\nimport * as React from \"react\";\r\nimport { useEffect } from \"react\";\r\nimport Markdown from \"react-markdown\";\r\nimport { useDispatch } from \"react-redux\";\r\n\r\nimport \"github-markdown-css\";\r\nimport { useSelector } from \"react-redux\";\r\nimport { RootState } from \"../../../app/store\";\r\nimport { changeLogActions } from \"..\";\r\n\r\nconst useStyles = makeStyles((theme) =>\r\n  createStyles({\r\n    paper: {\r\n      padding: theme.spacing(1),\r\n    },\r\n  })\r\n);\r\n\r\nexport const ChangeLog: React.FC = () => {\r\n  const classes = useStyles();\r\n  const dispatch = useDispatch();\r\n\r\n  const { article } = useSelector((state: RootState) => state.changeLog);\r\n  useEffect(() => {\r\n    dispatch(changeLogActions.init());\r\n  }, [dispatch]);\r\n\r\n  return (\r\n    <React.Fragment>\r\n      <Paper className={classes.paper}>\r\n        {article !== \"\" ? (\r\n          <Markdown source={article} className=\"markdown-body\" />\r\n        ) : null}\r\n      </Paper>\r\n    </React.Fragment>\r\n  );\r\n};\r\n","import { createSlice, PayloadAction } from \"@reduxjs/toolkit\";\r\n\r\nexport type ChangeLogState = {\r\n  article: string;\r\n};\r\n\r\nconst slice = createSlice({\r\n  name: \"change-log\",\r\n  initialState: { article: \"\" } as ChangeLogState,\r\n  reducers: {\r\n    init: () => {},\r\n    set: (draft, action: PayloadAction<ChangeLogState[\"article\"]>) => {\r\n      draft.article = action.payload;\r\n    },\r\n  },\r\n});\r\n\r\nexport const { actions, reducer } = slice;\r\nexport type ChangeLogAction = ReturnType<typeof actions[keyof typeof actions]>;\r\n","import { Epic, combineEpics } from \"redux-observable\";\r\n\r\nimport { changeLogActions, ChangeLogAction } from \"..\";\r\nimport { withIndicator, IndicatorAction } from \"../../indicator\";\r\nimport { fetchChangeLogs } from \"./logic\";\r\n\r\nexport const fetchDefsEpic: Epic<\r\n  ChangeLogAction | IndicatorAction,\r\n  ChangeLogAction | IndicatorAction\r\n> = (action$) =>\r\n  action$\r\n    .ofType(changeLogActions.init.type)\r\n    .pipe(\r\n      withIndicator(\"change-logs/fetch\", async () =>\r\n        changeLogActions.set(await fetchChangeLogs())\r\n      )\r\n    );\r\n\r\nexport const epic = combineEpics(fetchDefsEpic);\r\n","export const fetchChangeLogs = () =>\r\n  fetch(`${process.env.PUBLIC_URL}/assets/change-log.md`).then((res) =>\r\n    res.text()\r\n  );\r\n","import React, { useEffect, useMemo, useState } from \"react\";\r\nimport { Redirect, Route, Switch } from \"react-router\";\r\nimport { BrowserRouter } from \"react-router-dom\";\r\nimport { Family } from \"./features/family/Family\";\r\nimport { Http404 } from \"./features/errors/404\";\r\nimport {\r\n  AppBar,\r\n  Box,\r\n  Drawer,\r\n  IconButton,\r\n  Link as Anchor,\r\n  List,\r\n  ListItem,\r\n  ListItemIcon,\r\n  ListItemText,\r\n  Toolbar,\r\n  Typography,\r\n  useTheme,\r\n} from \"@material-ui/core\";\r\nimport { Link } from \"react-router-dom\";\r\nimport {\r\n  List as ListIcon,\r\n  MenuOutlined,\r\n  Timeline as TimelineIcon,\r\n  ChangeHistory as ChangeHistoryIcon,\r\n} from \"@material-ui/icons\";\r\nimport { useDispatch } from \"react-redux\";\r\nimport { horseDefsActions } from \"./features/horse-defs\";\r\nimport { MareLine } from \"./features/mare-line\";\r\nimport { Indicator } from \"./features/indicator\";\r\nimport { PedigreeDialog } from \"./features/pedigree\";\r\nimport { ChangeLog } from \"./features/changelog\";\r\n\r\nimport \"./App.css\";\r\n\r\ntype MenuItemDef = {\r\n  icon: JSX.Element;\r\n  label: string;\r\n  path: string;\r\n  page: JSX.Element;\r\n};\r\n\r\nconst renderListItem = (def: MenuItemDef) => {\r\n  return (\r\n    <ListItem key={def.path} button={true} component={Link} to={def.path}>\r\n      <ListItemIcon>{def.icon}</ListItemIcon>\r\n      <ListItemText primary={def.label} />\r\n    </ListItem>\r\n  );\r\n};\r\n\r\nconst defs: MenuItemDef[] = [\r\n  {\r\n    icon: <ListIcon />,\r\n    label: \"牝系図\",\r\n    path: \"/mare-line\",\r\n    page: <MareLine />,\r\n  },\r\n  {\r\n    icon: <TimelineIcon />,\r\n    label: \"家系図(旧)\",\r\n    path: \"/family\",\r\n    page: <Family />,\r\n  },\r\n  {\r\n    icon: <ChangeHistoryIcon />,\r\n    label: \"更新履歴\",\r\n    path: \"/change-log\",\r\n    page: <ChangeLog />,\r\n  },\r\n];\r\n\r\nconst MenuList: React.FC<{\r\n  toggleMenu: () => void;\r\n}> = ({ toggleMenu }) => {\r\n  return (\r\n    <List onClick={toggleMenu} onKeyDown={toggleMenu}>\r\n      {defs.map(renderListItem)}\r\n    </List>\r\n  );\r\n};\r\n\r\nconst Header: React.FC = () => {\r\n  const [menuOpen, setMenuOpen] = useState<boolean>(false);\r\n\r\n  const toggleMenu = useMemo(\r\n    () => () => {\r\n      setMenuOpen(!menuOpen);\r\n    },\r\n    [menuOpen, setMenuOpen]\r\n  );\r\n\r\n  return (\r\n    <React.Fragment>\r\n      <AppBar position=\"static\">\r\n        <Toolbar>\r\n          <IconButton\r\n            edge=\"start\"\r\n            color=\"inherit\"\r\n            aria-label=\"menu\"\r\n            onClick={toggleMenu}\r\n          >\r\n            <MenuOutlined />\r\n          </IconButton>\r\n          <Typography variant=\"h6\">MOTTV Derby</Typography>\r\n          {/* <Button color=\"inherit\">Login</Button> */}\r\n        </Toolbar>\r\n      </AppBar>\r\n      <Drawer open={menuOpen} onClose={toggleMenu}>\r\n        <MenuList toggleMenu={toggleMenu} />\r\n      </Drawer>\r\n    </React.Fragment>\r\n  );\r\n};\r\n\r\nconst Footer: React.FC = () => {\r\n  const theme = useTheme();\r\n  return (\r\n    <Box display=\"flex\" justifyContent=\"flex-end\" margin={theme.spacing(0.2)}>\r\n      <Anchor href=\"https://www.youtube.com/user/MOTTYGAMES/\" target=\"__blank\">\r\n        MOTTV\r\n      </Anchor>\r\n    </Box>\r\n  );\r\n};\r\n\r\nexport const App: React.FC = () => {\r\n  const theme = useTheme();\r\n  const dispatch = useDispatch();\r\n\r\n  useEffect(() => {\r\n    dispatch(horseDefsActions.init());\r\n  }, [dispatch]);\r\n\r\n  return (\r\n    <BrowserRouter basename={process.env.PUBLIC_URL}>\r\n      <React.Fragment>\r\n        <Header />\r\n        <Box margin={theme.spacing(0.5)}>\r\n          <Switch>\r\n            {defs.map(({ path, page }) => (\r\n              <Route path={path}>{page}</Route>\r\n            ))}\r\n            <Route exact path=\"/\">\r\n              <Redirect to=\"/mare-line\" />\r\n            </Route>\r\n            <Route>\r\n              <Http404 />\r\n            </Route>\r\n          </Switch>\r\n        </Box>\r\n        <Footer />\r\n        <PedigreeDialog />\r\n        <Indicator />\r\n      </React.Fragment>\r\n    </BrowserRouter>\r\n  );\r\n};\r\n","import { configureStore } from \"@reduxjs/toolkit\";\r\nimport { Action } from \"redux\";\r\nimport { combineEpics, createEpicMiddleware } from \"redux-observable\";\r\n\r\nimport { horseDefsReducer, horseDefsEpic } from \"../features/horse-defs\";\r\nimport { indicatorReducer } from \"../features/indicator\";\r\nimport { pedigreeReducer } from \"../features/pedigree\";\r\nimport { changeLogReducer, changeLogEpic } from \"../features/changelog\";\r\n\r\nconst dependencies = {};\r\nconst epicMiddleware = createEpicMiddleware<\r\n  Action,\r\n  Action,\r\n  void,\r\n  typeof dependencies\r\n>({\r\n  dependencies,\r\n});\r\n\r\nexport const store = configureStore({\r\n  reducer: {\r\n    horseDefs: horseDefsReducer,\r\n    indicator: indicatorReducer,\r\n    pedigree: pedigreeReducer,\r\n    changeLog: changeLogReducer,\r\n  },\r\n  middleware: (getDefaultMiddleware) =>\r\n    getDefaultMiddleware({\r\n      thunk: false,\r\n    }).concat([epicMiddleware]),\r\n});\r\n\r\nepicMiddleware.run(combineEpics(horseDefsEpic, changeLogEpic) as any);\r\n\r\nexport type RootState = ReturnType<typeof store.getState>;\r\nexport type Dependencies = typeof dependencies;\r\n","// This optional code is used to register a service worker.\r\n// register() is not called by default.\r\n\r\n// This lets the app load faster on subsequent visits in production, and gives\r\n// it offline capabilities. However, it also means that developers (and users)\r\n// will only see deployed updates on subsequent visits to a page, after all the\r\n// existing tabs open on the page have been closed, since previously cached\r\n// resources are updated in the background.\r\n\r\n// To learn more about the benefits of this model and instructions on how to\r\n// opt-in, read https://bit.ly/CRA-PWA\r\n\r\nconst isLocalhost = Boolean(\r\n  window.location.hostname === 'localhost' ||\r\n    // [::1] is the IPv6 localhost address.\r\n    window.location.hostname === '[::1]' ||\r\n    // 127.0.0.0/8 are considered localhost for IPv4.\r\n    window.location.hostname.match(\r\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\r\n    )\r\n);\r\n\r\ntype Config = {\r\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\r\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\r\n};\r\n\r\nexport function register(config?: Config) {\r\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\r\n    // The URL constructor is available in all browsers that support SW.\r\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\r\n    if (publicUrl.origin !== window.location.origin) {\r\n      // Our service worker won't work if PUBLIC_URL is on a different origin\r\n      // from what our page is served on. This might happen if a CDN is used to\r\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\r\n      return;\r\n    }\r\n\r\n    window.addEventListener('load', () => {\r\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\r\n\r\n      if (isLocalhost) {\r\n        // This is running on localhost. Let's check if a service worker still exists or not.\r\n        checkValidServiceWorker(swUrl, config);\r\n\r\n        // Add some additional logging to localhost, pointing developers to the\r\n        // service worker/PWA documentation.\r\n        navigator.serviceWorker.ready.then(() => {\r\n          console.log(\r\n            'This web app is being served cache-first by a service ' +\r\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\r\n          );\r\n        });\r\n      } else {\r\n        // Is not localhost. Just register service worker\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\nfunction registerValidSW(swUrl: string, config?: Config) {\r\n  navigator.serviceWorker\r\n    .register(swUrl)\r\n    .then(registration => {\r\n      registration.onupdatefound = () => {\r\n        const installingWorker = registration.installing;\r\n        if (installingWorker == null) {\r\n          return;\r\n        }\r\n        installingWorker.onstatechange = () => {\r\n          if (installingWorker.state === 'installed') {\r\n            if (navigator.serviceWorker.controller) {\r\n              // At this point, the updated precached content has been fetched,\r\n              // but the previous service worker will still serve the older\r\n              // content until all client tabs are closed.\r\n              console.log(\r\n                'New content is available and will be used when all ' +\r\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\r\n              );\r\n\r\n              // Execute callback\r\n              if (config && config.onUpdate) {\r\n                config.onUpdate(registration);\r\n              }\r\n            } else {\r\n              // At this point, everything has been precached.\r\n              // It's the perfect time to display a\r\n              // \"Content is cached for offline use.\" message.\r\n              console.log('Content is cached for offline use.');\r\n\r\n              // Execute callback\r\n              if (config && config.onSuccess) {\r\n                config.onSuccess(registration);\r\n              }\r\n            }\r\n          }\r\n        };\r\n      };\r\n    })\r\n    .catch(error => {\r\n      console.error('Error during service worker registration:', error);\r\n    });\r\n}\r\n\r\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\r\n  // Check if the service worker can be found. If it can't reload the page.\r\n  fetch(swUrl, {\r\n    headers: { 'Service-Worker': 'script' },\r\n  })\r\n    .then(response => {\r\n      // Ensure service worker exists, and that we really are getting a JS file.\r\n      const contentType = response.headers.get('content-type');\r\n      if (\r\n        response.status === 404 ||\r\n        (contentType != null && contentType.indexOf('javascript') === -1)\r\n      ) {\r\n        // No service worker found. Probably a different app. Reload the page.\r\n        navigator.serviceWorker.ready.then(registration => {\r\n          registration.unregister().then(() => {\r\n            window.location.reload();\r\n          });\r\n        });\r\n      } else {\r\n        // Service worker found. Proceed as normal.\r\n        registerValidSW(swUrl, config);\r\n      }\r\n    })\r\n    .catch(() => {\r\n      console.log(\r\n        'No internet connection found. App is running in offline mode.'\r\n      );\r\n    });\r\n}\r\n\r\nexport function unregister() {\r\n  if ('serviceWorker' in navigator) {\r\n    navigator.serviceWorker.ready\r\n      .then(registration => {\r\n        registration.unregister();\r\n      })\r\n      .catch(error => {\r\n        console.error(error.message);\r\n      });\r\n  }\r\n}\r\n","import { createMuiTheme, MuiThemeProvider } from '@material-ui/core';\r\nimport React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './index.css';\r\nimport { App } from './App';\r\nimport { store } from './app/store';\r\nimport { Provider } from 'react-redux';\r\nimport * as serviceWorker from './serviceWorker';\r\n\r\nconst theme = createMuiTheme({});\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <MuiThemeProvider theme={theme}>\r\n      <Provider store={store}>\r\n        <App />\r\n      </Provider>\r\n    </MuiThemeProvider>\r\n  </React.StrictMode>,\r\n  document.getElementById('root')\r\n);\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: https://bit.ly/CRA-PWA\r\nserviceWorker.unregister();\r\n"],"sourceRoot":""}