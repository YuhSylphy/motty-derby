(this["webpackJsonpmotty-derby"]=this["webpackJsonpmotty-derby"]||[]).push([[0],{270:function(e,t,n){},457:function(e,t,n){},467:function(e,t,n){},469:function(e,t,n){"use strict";n.r(t);var a=n(2),r=n(247),c=n(508),o=n(0),s=n.n(o),i=n(14),u=n.n(i),l=(n(270),n(137)),j=n(10),f=n(135),h=n(510),b=n(254),m=n(255),d=n(74),O=n(164),p=(n(457),n(20)),x=function(){var e=Object(o.useRef)(null),t=Object(p.c)((function(e){return e.horseDefs.list})),n=Object(o.useMemo)((function(){return function(e){var t=new Map,n=[];return e.forEach((function(e){t.set(e.name,{label:e.name,class:"owned ".concat(e.sex)}),e.motherName&&(t.has(e.motherName)||t.set(e.motherName,{label:e.motherName,class:"anothers female"}),n.push([{v:e.motherName,w:e.name},{class:"mother"}])),e.fatherName&&(t.has(e.fatherName)||t.set(e.fatherName,{label:e.fatherName,class:"anothers male"}),n.push([{v:e.fatherName,w:e.name},{class:"father"}]))})),{nodes:Array.from(t.entries()),edges:n}}(t)}),[t]);return Object(o.useEffect)((function(){var t=d.select(e.current);if(t.selectAll("g").remove(),0!==n.nodes.length||0!==n.edges.length){var a=(new O.graphlib.Graph).setGraph({rankdir:"LR"}).setDefaultEdgeLabel((function(){return{}}));n.nodes.forEach((function(e){a.setNode(e[0],e[1])})),a.nodes().forEach((function(e){var t=a.node(e);t.rx=t.ry=5})),n.edges.forEach((function(e){a.setEdge(e[0],e[1])}));var r=new O.render,c=t.append("g"),o=d.zoom().on("zoom",(function(){c.attr("transform",d.event.transform)}));t.call(o),r(d.select("svg g"),a);var s=(Number(t.attr("width"))-(a.graph().width||0))/2;c.attr("transform","translate(".concat(Number.isNaN(s)?0:s,", 20)"))}}),[e,n]),Object(a.jsx)(o.Fragment,{children:Object(a.jsx)("svg",{className:"d3-component mottv-derby-family",width:"100%",height:"70vh",ref:e})})},g=function(){return Object(a.jsxs)(h.a,{children:[Object(a.jsx)(b.a,{variant:"h4",children:"\u7cfb\u56f3"}),Object(a.jsx)(m.a,{children:Object(a.jsx)(x,{})})]})},w=function(){return Object(a.jsx)("h2",{children:"404 NOT FOUND"})},v=n(514),y=n(504),N=n(505),M=n(511),k=n(515),E=n(52),D=n(507),F=n(506),C=n(54),S=Object(C.b)({name:"horseDefs",initialState:{list:[]},reducers:{init:function(){},set:function(e,t){e.list=t.payload.list}}}),I=S.actions,T=S.reducer,A=n(166),z=n.n(A),L=n(241),G=n(512),B=n(250),J=n(249),R=n(85),V=n(87),W=Object(C.b)({name:"indicator",initialState:{awaits:{}},reducers:{set:function(e,t){e.awaits=t.payload},open:function(e,t){var n=t.payload;e.awaits=Object(V.a)(Object(V.a)({},e.awaits),{},Object(R.a)({},n,1+(n in e.awaits?e.awaits[n]:0)))},close:function(e,t){var n=t.payload;if(n in e.awaits){var a=e.awaits,r=a[n],c=Object(B.a)(a,[n].map(J.a));e.awaits=Object(V.a)(Object(V.a)({},c),r>1?Object(R.a)({},n,r-1):{})}else console.warn("there isnt key [".concat(n,"] in "))}}}),_=W.actions,K=W.reducer,P=n(517),U=n(128),Y=n(493),$=n(251),q=_.open,H=_.close,Q=n(494),X=n(471),Z=n(495),ee=Object(Q.a)((function(e){return{backdrop:{zIndex:e.zIndex.drawer+1,color:"#fff"}}})),te=function(){var e=ee(),t=Object(p.c)((function(e){return e.indicator})).awaits,n=Object(o.useMemo)((function(){return Object.values(t).some((function(e){return e>0}))}),[t]);return Object(a.jsx)(X.a,{className:e.backdrop,open:n,children:Object(a.jsx)(Z.a,{color:"inherit"})})},ne=Object(G.a)((function(e){return e.ofType(I.init.type).pipe((t="horse-defs/fetch",n=Object(L.a)(z.a.mark((function e(){return z.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=I,e.next=3,fetch("".concat("/motty-derby","/assets/horse-defs.json")).then((function(e){return e.json()})).then((function(e){return e.filter((function(e){return!e.removed}))}));case 3:return e.t1=e.sent,e.t2={list:e.t1},e.abrupt("return",e.t0.set.call(e.t0,e.t2));case 6:case"end":return e.stop()}}),e)}))),function(e){return e.pipe(Object($.a)((function(e){return Object(P.a)(Object(U.a)(q(t)),Object(Y.a)((function(){return n(e)})),Object(U.a)(H(t)))})))}));var t,n})),ae=n(248),re=n(513),ce=n(518),oe=n(503),se=n(244),ie=n.n(se),ue=n(245),le=n.n(ue),je=n(246),fe=n.n(je),he=n(243),be=n.n(he),me=n(167),de=n(168),Oe=Object(C.b)({name:"pedigree",initialState:{displays:[]},reducers:{set:function(e,t){e.displays=t.payload},push:function(e,t){var n=t.payload;e.displays.push(n)},pop:function(e,t){e.displays.length<=0?console.warn("pedigree list is empty"):e.displays.pop()},clear:function(e,t){e.displays=[]}}}),pe=Oe.actions,xe=Oe.reducer,ge=n(501),we=n(502),ve=n(496),ye=n(497),Ne=n(498),Me=n(499),ke=n(500),Ee=Object(Q.a)((function(e){return Object(re.a)({table:{"& .cell":{"&.empty":{backgroundColor:"lightgray"}}}})})),De=function(e){return Object(a.jsx)(o.Fragment,{children:e.map((function(e,t){return Object(a.jsx)(ye.a,{children:e.filter((function(e,t){return t>0})).map((function(e,n){return function(e,t,n){var r=Math.pow(2,4-t);return Object(a.jsx)(o.Fragment,{children:e%r===0?Object(a.jsx)(ve.a,{rowSpan:r,className:["cell",n.show?"":"empty"].join(" "),children:n.show?Object(a.jsx)(h.a,{children:n.name}):Object(a.jsx)(h.a,{})}):null},"col-".concat(t))}(t,n,e)}))},"row-".concat(t))}))})},Fe=function(e){var t=e.def,n=Ee(),r=Object(p.c)((function(e){return e.horseDefs.list})),c=function(e){return function(t){for(var n=new Array,a=0;a<32;++a){for(var r=new Array,c=0;c<5;++c)r.push({name:"empty",generation:c,show:!1});n.push(r)}return function t(a,r,c){console.info("mapPedigree",a,r,c),n[a][r]={name:c.name,generation:0,show:!0},r<5&&(console.info("if",c),c.fatherName&&(e.has(c.fatherName)?(console.info("father",e.get(c.fatherName)),t(a,r+1,e.get(c.fatherName))):t(a,r+1,{name:c.fatherName,sex:"male"})),c.motherName&&(e.has(c.motherName)?(console.info("mother",e.get(c.motherName)),t(a+Math.pow(2,5-r-1),r+1,e.get(c.motherName))):t(a+Math.pow(2,5-r-1),r+1,{name:c.motherName,sex:"female"})))}(0,0,t),console.info(n),n}}(Object(o.useMemo)((function(){return r.reduce((function(e,t){return e.set(t.name,t)}),new Map)}),[r]))(t);return Object(a.jsx)(Ne.a,{component:m.a,children:Object(a.jsx)(Me.a,{className:n.table,children:Object(a.jsx)(ke.a,{children:De(c)})})})},Ce=function(){var e=Object(p.b)(),t=Object(p.c)((function(e){return e.pedigree})).displays,n=Object(o.useMemo)((function(){return t.length>0}),[t]),r=Object(p.c)((function(e){return e.horseDefs.list})),c=Object(o.useMemo)((function(){return t.length>0?r.find((function(e){return e.name===t[t.length-1]})):void 0}),[r,t]),s=Object(o.useMemo)((function(){return function(){e(pe.clear())}}),[e]);return c?Object(a.jsxs)(ge.a,{open:n,onClose:s,children:[Object(a.jsxs)(we.a,{children:["\u8840\u7d71\u8868: ",c.name]}),Object(a.jsx)(Fe,{def:c})]}):null},Se=Object(Q.a)((function(e){return Object(re.a)({root:{"& .name":{marginLeft:e.spacing(.5)},"& .father":{marginLeft:e.spacing(1)},"& .male":{color:"#2196f3"},"& .female":{color:"#f44336"}}})})),Ie=function(e){var t=e.name,n=Object(p.b)(),r=Object(o.useMemo)((function(){return function(){n(pe.push(t))}}),[n,t]);return Object(a.jsx)(M.a,{"aria-label":"horse info",size:"small",onClick:r,children:Object(a.jsx)(be.a,{fontSize:"inherit"})})},Te=function(e){var t=new Map,n=function(e){return t.has(e)?t.get(e):function(){var n={id:e,label:Object(a.jsx)(o.Fragment,{}),children:[],owned:!1};return t.set(e,n),n}()};return e.forEach((function(e){var t=n(e.name);(function(e,t){e.owned=!0,e.className=[t.sex].join(" "),e.label=Object(a.jsxs)(o.Fragment,{children:[function(){switch(t.sex){case"male":return Object(a.jsx)(me.a,{icon:de.a});case"female":return Object(a.jsx)(me.a,{icon:de.b});case"unknown":return null;default:t.sex}}(),Object(a.jsxs)("span",{className:"name",children:[t.name,Object(a.jsx)(Ie,{name:t.name})]}),t.fatherName?Object(a.jsxs)("span",{className:"father male",children:["(",t.fatherName,")"]}):null]}),e.fatherName=t.fatherName,e.motherName=t.motherName}(t,e),e.motherName)&&n(e.motherName).children.push(t)})),{nodes:Array.from(t.values()).filter((function(e){var n;return e.owned&&(!e.motherName||!t.has(e.motherName)||t.has(e.motherName)&&!(null===(n=t.get(e.motherName))||void 0===n?void 0:n.owned))})),ids:Array.from(t.keys())}},Ae=function e(t){return function(n){return Object(a.jsx)(ce.a,{className:n.className,nodeId:n.id,label:n.label,onIconClick:t(n),children:n.children.map(e(t))},n.id)}},ze=function(){var e=Se(),t=Object(p.b)(),n=Object(o.useState)([]),r=Object(l.a)(n,2),c=r[0],s=r[1],i=Object(p.c)((function(e){return e.horseDefs.list})),u=Object(o.useMemo)((function(){return i.length>0?function(e){return function(t){return function(n){try{return e(q(t)),n()}finally{e(H(t))}}}}(t)("mare-line/init")((function(){return Te(i)})):{nodes:[],ids:[]}}),[t,i]),j=u.nodes,f=u.ids;Object(o.useEffect)((function(){s(f)}),[s,f]);var h=Object(o.useMemo)((function(){return function(e){return function(t){s(c.includes(e.id)?c.filter((function(t){return t!==e.id})):[].concat(Object(ae.a)(c),[e.id]))}}}),[c,s]);return Object(a.jsx)(o.Fragment,{children:Object(a.jsx)(oe.a,{className:e.root,expanded:c,defaultCollapseIcon:Object(a.jsx)(ie.a,{}),defaultExpandIcon:Object(a.jsx)(le.a,{}),defaultEndIcon:Object(a.jsx)(fe.a,{}),children:j.map(Ae(h))})})},Le=function(){return Object(a.jsxs)(o.Fragment,{children:[Object(a.jsx)(b.a,{variant:"h4",children:"\u725d\u7cfb\u56f3"}),Object(a.jsx)(m.a,{children:Object(a.jsx)(ze,{})})]})},Ge=(n(467),function(e){return Object(a.jsx)(b.a,{children:Object(a.jsx)(f.b,{to:e.path,children:e.label})})}),Be=function(e){var t=e.toggleMenu;return Object(a.jsx)(v.a,{onClick:t,onKeyDown:t,children:[{label:"\u725d\u7cfb\u56f3",path:"/mare-line"},{label:"\u5bb6\u7cfb\u56f3(\u65e7)",path:"/family"}].map(Ge)})},Je=function(){var e=Object(o.useState)(!1),t=Object(l.a)(e,2),n=t[0],r=t[1],c=Object(o.useMemo)((function(){return function(){r(!n)}}),[n,r]);return Object(a.jsxs)(s.a.Fragment,{children:[Object(a.jsx)(y.a,{position:"static",children:Object(a.jsxs)(N.a,{children:[Object(a.jsx)(M.a,{edge:"start",color:"inherit","aria-label":"menu",onClick:c,children:Object(a.jsx)(F.a,{})}),Object(a.jsx)(b.a,{variant:"h6",children:"MOTTV Derby"})]})}),Object(a.jsx)(k.a,{open:n,onClose:c,children:Object(a.jsx)(Be,{toggleMenu:c})})]})},Re=function(){var e=Object(E.a)();return Object(a.jsx)(h.a,{display:"flex",justifyContent:"flex-end",margin:e.spacing(.2),children:Object(a.jsx)(D.a,{href:"https://www.youtube.com/user/MOTTYGAMES/",target:"__blank",children:"MOTTV"})})},Ve=function(){var e=Object(E.a)(),t=Object(p.b)();return Object(o.useEffect)((function(){t(I.init())}),[t]),Object(a.jsx)(f.a,{basename:"/motty-derby",children:Object(a.jsxs)(s.a.Fragment,{children:[Object(a.jsx)(Je,{}),Object(a.jsx)(h.a,{margin:e.spacing(.5),children:Object(a.jsxs)(j.d,{children:[Object(a.jsx)(j.b,{path:"/family",children:Object(a.jsx)(g,{})}),Object(a.jsx)(j.b,{path:"/mare-line",children:Object(a.jsx)(Le,{})}),Object(a.jsx)(j.b,{exact:!0,path:"/",children:Object(a.jsx)(j.a,{to:"/mare-line"})}),Object(a.jsx)(j.b,{children:Object(a.jsx)(w,{})})]})}),Object(a.jsx)(Re,{}),Object(a.jsx)(Ce,{}),Object(a.jsx)(te,{})]})})},We=n(509),_e=Object(We.a)({dependencies:{}}),Ke=Object(C.a)({reducer:{horseDefs:T,indicator:K,pedigree:xe},middleware:function(e){return e({thunk:!1}).concat([_e])}});_e.run(Object(G.a)(ne));Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var Pe=Object(r.a)({});u.a.render(Object(a.jsx)(s.a.StrictMode,{children:Object(a.jsx)(c.a,{theme:Pe,children:Object(a.jsx)(p.a,{store:Ke,children:Object(a.jsx)(Ve,{})})})}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[469,1,2]]]);
//# sourceMappingURL=main.47acd2aa.chunk.js.map